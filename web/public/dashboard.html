<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sol Seeker Dashboard</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        'blade-amber': '#ff8c00',
                        'blade-orange': '#ff6b35',
                        'blade-cyan': '#00e5ff',
                        'blade-blue': '#0091ea',
                        'blade-yellow': '#ffab00',
                        'deep-black': '#000000',
                        'void-black': '#0a0a0a',
                        'panel-black': '#111111',
                        'glass-black': 'rgba(17, 17, 17, 0.85)'
                    },
                    fontFamily: {
                        'mono': ['Share Tech Mono', 'Courier New', 'monospace'],
                        'display': ['Rajdhani', 'system-ui', 'sans-serif']
                    }
                }
            }
        }
    </script>
    
    <script>
        // Resolve API base and key with fallback to backend port
        let apiBase = localStorage.getItem('sol_seeker_api_base');
        const { protocol, hostname, port } = window.location;
        if (!apiBase) {
            apiBase = port === '5173'
                ? `${protocol}//${hostname}:8000`
                : `${protocol}//${hostname}${port ? ':' + port : ''}`;
            localStorage.setItem('sol_seeker_api_base', apiBase);
        }
        const apiKey = localStorage.getItem('sol_seeker_api_key') || '';
        window.API_BASE = apiBase;
        window.API_KEY = apiKey;
        fetch(`${apiBase}/health`, { headers: apiKey ? { 'X-API-Key': apiKey } : {} })
            .then(res => {
                if (!res.ok) throw new Error('health check failed');
            })
            .catch(() => {
                const input = window.prompt('Enter API base URL', apiBase);
                if (input) {
                    apiBase = input;
                    localStorage.setItem('sol_seeker_api_base', apiBase);
                    window.API_BASE = apiBase;
                    if (window.SolSeekerAPI) {
                        window.SolSeekerAPI.setApiBase(apiBase);
                    }
                }
            });
    </script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    
        <link rel="stylesheet" href="dashboard.css">
</head>
<body class="text-white font-display min-h-screen relative">
    <!-- Atmospheric Background -->
    <div class="atmospheric-glow"></div>
    <div id="toastContainer" class="fixed top-4 right-4 space-y-2 z-50"></div>

    <!-- Fixed Header -->
    <header class="fixed top-0 left-0 right-0 z-50 bg-glass-black border-b border-blade-amber/30 backdrop-filter backdrop-blur-lg">
        <div class="max-w-full px-8 py-4 flex items-center justify-between">
            <!-- Left: Title and License -->
            <div class="flex items-center space-x-8">
                <div class="flex items-center space-x-4">
                    <h1 class="text-3xl font-bold text-white hologram-text tracking-wider">
                        SOLSEEKER DASHBOARD
                    </h1>
                    <div class="px-3 py-1 bg-blade-yellow/20 border border-blade-yellow/50 rounded text-xs hologram-text status-demo">
                        DEMO MODE
                    </div>
                </div>
            </div>
            
            <!-- Center: Connection Status -->
            <div class="flex items-center space-x-6">
                <div class="flex items-center space-x-2 tooltip-trigger relative">
                    <div class="w-2 h-2 bg-cyan-glow rounded-full status-online"></div>
                    <span class="text-xs hologram-text cyan-glow">RPC</span>
                    <span id="rpcLatency" class="text-xs hologram-text text-blade-amber">--ms</span>
                    <div id="rpcTooltip" class="tooltip absolute bottom-full mb-2 px-3 py-2 text-xs rounded">
                        Solana RPC Connection: Active<br/>
                        Latency: --ms<br/>
                        Last Update: --
                    </div>
                </div>
                <div class="flex items-center space-x-2 tooltip-trigger relative">
                    <span class="text-xs hologram-text cyan-glow">WS</span>
                    <span id="wsStatus" class="flex items-center space-x-1">
                        <span class="w-2 h-2 bg-cyan-glow rounded-full"></span>
                        <span class="text-xs hologram-text cyan-glow">LIVE</span>
                    </span>
                    <div class="tooltip absolute bottom-full mb-2 px-3 py-2 text-xs rounded">
                        WebSocket Connection: Streaming<br/>
                        Slot Updates: Live
                    </div>
                </div>
            </div>
            
            <!-- Right: Global Controls -->
            <div class="flex items-center space-x-4">
                <button class="control-button px-4 py-2 rounded text-xs hologram-text tooltip-trigger relative" id="tradingToggle">
                    ▶ START
                    <div id="tradingTooltip" class="tooltip absolute bottom-full mb-2 px-3 py-2 text-xs rounded right-0">
                        Start/Pause Trading Engine
                    </div>
                </button>
                <button class="emergency-stop px-4 py-2 rounded text-xs hologram-text tooltip-trigger relative">
                    ⏹ STOP
                    <div class="tooltip absolute bottom-full mb-2 px-3 py-2 text-xs rounded right-0">
                        Emergency Stop - Close All Positions
                    </div>
                </button>
                <button class="control-button px-3 py-2 rounded text-xs hologram-text tooltip-trigger relative" id="settingsToggle">
                    ⚙
                    <div class="tooltip absolute bottom-full mb-2 px-3 py-2 text-xs rounded right-0">
                        System Health & Settings
                    </div>
                </button>
                <div class="text-xs hologram-text text-blade-amber/60" id="systemTime">00:00:00 UTC</div>
            </div>
        </div>
    </header>

    <!-- Main Dashboard Content -->
    <div class="pt-20 px-8 pb-8">
        <!-- Key Metrics Summary Panel -->
        <div class="mb-8">
            <h2 class="text-xl font-semibold text-white hologram-text mb-6 tracking-wider">
                SYSTEM METRICS
            </h2>
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6">
                <!-- Total Portfolio Value -->
                <div class="metric-card p-6 rounded scan-lines">
                    <div class="flex items-center justify-between mb-2">
                        <span class="text-sm hologram-text text-blade-amber/80">PORTFOLIO VALUE</span>
                        <svg class="w-12 h-6" viewBox="0 0 48 24">
                            <path class="sparkline stroke-blade-amber" d="M2 20 Q12 16 24 12 T46 8"/>
                        </svg>
                    </div>
                    <div class="text-3xl font-bold amber-glow data-flicker" id="portfolioValue">
                        $0.00
                    </div>
                    <div class="text-sm hologram-text text-cyan-glow mt-1" id="portfolioChange">
                        +$0.00 (+0.00%)
                    </div>
                </div>

                <!-- Realized P&L -->
                <div class="metric-card p-6 rounded scan-lines">
                    <div class="flex items-center justify-between mb-2">
                        <span class="text-sm hologram-text text-blade-amber/80">REALIZED P&L</span>
                        <svg class="w-12 h-6" viewBox="0 0 48 24">
                            <path class="sparkline stroke-cyan-glow" d="M2 18 Q12 14 24 10 T46 6"/>
                        </svg>
                    </div>
                    <div class="text-3xl font-bold cyan-glow data-flicker" id="realizedPnL">
                        $0.00
                    </div>
                    <div class="text-sm hologram-text text-blade-amber/80 mt-1" id="realizedPnLChange">
                        ↗ +0.0% TODAY
                    </div>
                </div>

                <!-- Open Positions -->
                <div class="metric-card p-6 rounded scan-lines">
                    <div class="flex items-center justify-between mb-2">
                        <span class="text-sm hologram-text text-blade-amber/80">OPEN POSITIONS</span>
                        <div class="w-8 h-8 rounded-full bg-blade-amber/20 flex items-center justify-center">
                            <span id="openPositionsTotal" class="text-xs hologram-text amber-glow">0</span>
                        </div>
                    </div>
                    <div id="openPositionsActive" class="text-3xl font-bold amber-glow data-flicker">0 ACTIVE</div>
                    <div id="openPositionsBreakdown" class="text-sm hologram-text text-cyan-glow/80 mt-1">0 LONG • 0 SHORT</div>
                </div>

                <!-- System Status -->
                <div class="metric-card p-6 rounded scan-lines">
                    <div class="flex items-center justify-between mb-2">
                        <span class="text-sm hologram-text text-blade-amber/80">SYSTEM STATUS</span>
                        <div class="w-3 h-3 bg-cyan-glow rounded-full status-online"></div>
                    </div>
                    <div class="text-2xl font-bold cyan-glow data-flicker" id="systemStatus">
                        OPERATIONAL
                    </div>
                    <div class="text-sm hologram-text text-blade-amber/80 mt-1">
                        UPTIME: <span id="systemUptime">99.97%</span>
                    </div>
                </div>

                <!-- Backtest Results -->
                <div class="metric-card p-6 rounded scan-lines">
                    <div class="flex items-center justify-between mb-2">
                        <span class="text-sm hologram-text text-blade-amber/80">BACKTEST P&L</span>
                    </div>
                    <div class="text-3xl font-bold amber-glow data-flicker" id="backtestPnL">
                        --
                    </div>
                    <div class="text-sm hologram-text text-blade-amber/80 mt-1" id="backtestStats">
                        DD -- • SHARPE --
                    </div>
                </div>
            </div>
        </div>

        <!-- Main Dashboard Grid -->
        <div class="grid grid-cols-1 xl:grid-cols-3 lg:grid-cols-2 gap-8">
            <!-- Left Column: Portfolio & Positions -->
            <div class="xl:col-span-1 lg:col-span-1 space-y-8">
                <!-- Portfolio & Positions Panel -->
                <div class="hologram-panel p-6 rounded scan-lines">
                    <div class="flex items-center justify-between mb-6">
                        <h3 class="text-lg font-semibold text-white hologram-text tracking-wider">
                            PORTFOLIO & POSITIONS
                        </h3>
                        <div class="flex space-x-2">
                            <button class="tab-button active px-3 py-1 rounded text-xs hologram-text border" data-tab="positions">
                                POSITIONS
                            </button>
                            <button class="tab-button px-3 py-1 rounded text-xs hologram-text border" data-tab="history">
                                HISTORY
                            </button>
                        </div>
                    </div>
                    
                    <!-- Active Positions Tab -->
                    <div id="positionsTab" class="tab-content">
                        <div id="positionsList" class="space-y-2"></div>
                    </div>

                    <!-- Trade History Tab -->
                    <div id="historyTab" class="tab-content hidden">
                        <div id="historyList" class="space-y-3"></div>
                    </div>
                </div>

                <!-- Rug Pull Risk Alert -->
                <div class="hologram-panel p-6 rounded scan-lines mb-6" id="securityPanel">
                    <div class="flex items-center justify-between mb-4">
                        <h3 class="text-lg font-semibold text-white hologram-text tracking-wider">
                            RUG PULL DETECTION
                        </h3>
                        <div class="flex items-center space-x-2">
                            <div class="w-3 h-3 bg-cyan-glow rounded-full status-online" id="rugPullIndicator"></div>
                            <span class="hologram-text text-xs cyan-glow" id="rugPullActive">ACTIVE</span>
                        </div>
                    </div>

                    <!-- Main Risk Status -->
                    <div class="bg-void-black/50 p-4 rounded border border-cyan-glow/30 mb-4 tooltip-trigger relative" id="rugPullCard">
                        <div class="flex items-center justify-between">
                            <div class="flex items-center space-x-3">
                                <div class="relative">
                                    <svg class="w-8 h-8" viewBox="0 0 32 32">
                                        <defs>
                                            <filter id="shieldGlow">
                                                <feGaussianBlur stdDeviation="2" result="coloredBlur"/>
                                                <feMerge>
                                                    <feMergeNode in="coloredBlur"/>
                                                    <feMergeNode in="SourceGraphic"/>
                                                </feMerge>
                                            </filter>
                                        </defs>
                                        <path d="M16 2 L26 8 L26 18 Q26 26 16 30 Q6 26 6 18 L6 8 Z"
                                              fill="none" stroke="#00e5ff" stroke-width="2" filter="url(#shieldGlow)"/>
                                        <path d="M12 16 L15 19 L20 13" stroke="#00e5ff" stroke-width="2"
                                              stroke-linecap="round" stroke-linejoin="round" fill="none"/>
                                    </svg>
                                    <div class="absolute -top-1 -right-1 w-3 h-3 bg-cyan-glow rounded-full animate-pulse"></div>
                                </div>
                                <div>
                                    <div class="hologram-text text-white font-bold">SYSTEM SECURE</div>
                                    <div class="hologram-text text-xs text-blade-amber/80" id="rugPullDetail">No threats detected</div>
                                </div>
                            </div>
                            <div class="hologram-text text-cyan-glow font-bold" id="rugPull">SAFE</div>
                        </div>
                        <div class="tooltip absolute bottom-full mb-2 px-3 py-2 text-xs rounded right-0" id="rugPullTooltip">
                            Rug Pull Detection: ACTIVE
                        </div>
                    </div>

                    <!-- Risk Factors -->
                    <div class="space-y-3" id="securityFlags">
                        <div class="flex justify-between items-center tooltip-trigger relative">
                            <span class="hologram-text text-blade-amber/80 text-sm">LIQUIDITY ANALYSIS</span>
                            <span class="hologram-text cyan-glow text-sm" id="liquidity">✓ SAFE</span>
                            <div class="tooltip absolute bottom-full mb-2 px-3 py-2 text-xs rounded right-0"></div>
                        </div>
                        <div class="flex justify-between items-center tooltip-trigger relative">
                            <span class="hologram-text text-blade-amber/80 text-sm">CONTRACT VERIFICATION</span>
                            <span class="hologram-text cyan-glow text-sm" id="contractVerified">✓ SAFE</span>
                            <div class="tooltip absolute bottom-full mb-2 px-3 py-2 text-xs rounded right-0"></div>
                        </div>
                        <div class="flex justify-between items-center tooltip-trigger relative">
                            <span class="hologram-text text-blade-amber/80 text-sm">HOLDER DISTRIBUTION</span>
                            <span class="hologram-text cyan-glow text-sm" id="holderDistribution">✓ SAFE</span>
                            <div class="tooltip absolute bottom-full mb-2 px-3 py-2 text-xs rounded right-0"></div>
                        </div>
                        <div class="flex justify-between items-center tooltip-trigger relative">
                            <span class="hologram-text text-blade-amber/80 text-sm">TRADING PATTERNS</span>
                            <span class="hologram-text text-blade-yellow text-sm" id="tradingPatterns">⚠ WARN</span>
                            <div class="tooltip absolute bottom-full mb-2 px-3 py-2 text-xs rounded right-0"></div>
                        </div>
                    </div>
                </div>

                <!-- Risk Metrics -->
                <div class="hologram-panel p-6 rounded scan-lines" id="riskMetrics">
                    <h3 class="text-lg font-semibold text-white hologram-text mb-6 tracking-wider">
                        PORTFOLIO RISK
                    </h3>
                    <div class="space-y-4">
                        <div class="flex justify-between items-center tooltip-trigger relative">
                            <span class="hologram-text text-blade-amber/80">MAX DRAWDOWN</span>
                            <span class="hologram-text text-blade-orange" id="riskMaxDrawdown">-0%</span>
                            <div class="tooltip absolute bottom-full mb-2 px-3 py-2 text-xs rounded right-0">
                                Current drawdown from peak portfolio value.<br/>
                                Maximum allowed: 20%<br/>
                                Status: Within acceptable limits
                            </div>
                        </div>
                        <div class="flex justify-between items-center tooltip-trigger relative">
                            <span class="hologram-text text-blade-amber/80">POSITION SIZE</span>
                            <span class="hologram-text cyan-glow" id="positionSize">-</span>
                            <div class="tooltip absolute bottom-full mb-2 px-3 py-2 text-xs rounded right-0">
                                Position sizing based on Kelly Criterion<br/>
                                and risk-adjusted returns.<br/>
                                Current allocation: Optimal range
                            </div>
                        </div>
                        <div class="flex justify-between items-center tooltip-trigger relative">
                            <span class="hologram-text text-blade-amber/80">LEVERAGE RATIO</span>
                            <span class="hologram-text text-white" id="leverageRatio">0X</span>
                            <div class="tooltip absolute bottom-full mb-2 px-3 py-2 text-xs rounded right-0">
                                Average leverage across all positions.<br/>
                                Range: 1.5X - 3.0X<br/>
                                Risk level: Moderate
                            </div>
                        </div>
                        <div class="flex justify-between items-center tooltip-trigger relative">
                            <span class="hologram-text text-blade-amber/80">EXPOSURE</span>
                            <span class="hologram-text text-blade-yellow" id="exposure">0%</span>
                            <div class="tooltip absolute bottom-full mb-2 px-3 py-2 text-xs rounded right-0">
                                Percentage of capital currently deployed<br/>
                                in active trading positions.<br/>
                                Target range: 60-85%
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Right Column: Charts and Feed -->
            <div class="xl:col-span-2 lg:col-span-1 space-y-8">
                <!-- Chart Navigation Tabs -->
                <div class="flex space-x-4 mb-6">
                    <button class="chart-tab active px-4 py-2 bg-blade-amber/20 text-blade-amber rounded text-sm hologram-text border border-blade-amber/50" data-chart="equity">
                        EQUITY CURVE
                    </button>
                    <button class="chart-tab px-4 py-2 bg-void-black/50 text-blade-amber/60 rounded text-sm hologram-text border border-blade-amber/20" data-chart="pnl">
                        P&L BREAKDOWN
                    </button>
                    <button class="chart-tab px-4 py-2 bg-void-black/50 text-blade-amber/60 rounded text-sm hologram-text border border-blade-amber/20" data-chart="market">
                        MARKET DATA
                    </button>
                    <button class="chart-tab px-4 py-2 bg-void-black/50 text-blade-amber/60 rounded text-sm hologram-text border border-blade-amber/20" data-chart="regime">
                        REGIME ANALYSIS
                    </button>
                </div>

                <!-- Equity Curve Chart -->
                <div class="chart-panel hologram-panel p-6 rounded scan-lines" id="equityChart">
                    <div class="flex justify-between items-center mb-6">
                        <h3 class="text-lg font-semibold text-white hologram-text tracking-wider">
                            PORTFOLIO EQUITY CURVE
                        </h3>
                        <div class="flex space-x-2">
                            <button class="px-3 py-1 bg-blade-amber/20 text-blade-amber rounded text-xs hologram-text border border-blade-amber/50" data-tf="1H">1H</button>
                            <button class="px-3 py-1 bg-void-black/50 text-blade-amber/60 rounded text-xs hologram-text border border-blade-amber/20" data-tf="4H">4H</button>
                            <button class="px-3 py-1 bg-void-black/50 text-blade-amber/60 rounded text-xs hologram-text border border-blade-amber/20" data-tf="1D">1D</button>
                        </div>
                    </div>
                    <div class="chart-container h-96 rounded relative overflow-hidden" id="equityContainer">
                        <canvas id="equityCanvas" class="w-full h-full"></canvas>
                        <div class="absolute top-4 left-4">
                            <div class="hologram-text text-3xl cyan-glow data-flicker" id="equityCurrent">$0.00</div>
                            <div class="hologram-text text-sm text-blade-amber/80">CURRENT EQUITY</div>
                        </div>
                        <div class="absolute top-4 right-4 text-right">
                            <div class="hologram-text text-lg amber-glow" id="maxDrawdown">0%</div>
                            <div class="hologram-text text-sm text-blade-amber/80">MAX DRAWDOWN</div>
                        </div>
                    </div>
                </div>

                <!-- P&L Breakdown Chart -->
                <div class="chart-panel hologram-panel p-6 rounded scan-lines hidden" id="pnlChart">
                    <div class="flex justify-between items-center mb-6">
                        <h3 class="text-lg font-semibold text-white hologram-text tracking-wider">
                            PROFIT & LOSS ANALYSIS
                        </h3>
                        <div class="flex space-x-2">
                            <button class="px-3 py-1 bg-blade-amber/20 text-blade-amber rounded text-xs hologram-text border border-blade-amber/50">DAILY</button>
                            <button class="px-3 py-1 bg-void-black/50 text-blade-amber/60 rounded text-xs hologram-text border border-blade-amber/20">STRATEGY</button>
                        </div>
                    </div>
                    <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                        <!-- Daily P&L Bars -->
                        <div class="chart-container h-80 rounded relative overflow-hidden">
                            <svg class="w-full h-full" viewBox="0 0 500 300">
                                <defs>
                                    <linearGradient id="profitGradient" x1="0%" y1="0%" x2="0%" y2="100%">
                                        <stop offset="0%" stop-color="#00e5ff" stop-opacity="0.8" />
                                        <stop offset="100%" stop-color="#00e5ff" stop-opacity="0.4" />
                                    </linearGradient>
                                    <linearGradient id="lossGradient" x1="0%" y1="0%" x2="0%" y2="100%">
                                        <stop offset="0%" stop-color="#ff6b35" stop-opacity="0.8" />
                                        <stop offset="100%" stop-color="#ff6b35" stop-opacity="0.4" />
                                    </linearGradient>
                                </defs>
                                <!-- Grid -->
                                <g stroke="rgba(255, 140, 0, 0.1)" stroke-width="0.5">
                                    <line x1="0" y1="150" x2="500" y2="150"/>
                                    <line x1="0" y1="75" x2="500" y2="75"/>
                                    <line x1="0" y1="225" x2="500" y2="225"/>
                                </g>
                                <!-- P&L Bars -->
                                <rect x="30" y="120" width="25" height="30" fill="url(#profitGradient)" rx="2"/>
                                <rect x="70" y="100" width="25" height="50" fill="url(#profitGradient)" rx="2"/>
                                <rect x="110" y="150" width="25" height="40" fill="url(#lossGradient)" rx="2"/>
                                <rect x="150" y="80" width="25" height="70" fill="url(#profitGradient)" rx="2"/>
                                <rect x="190" y="110" width="25" height="40" fill="url(#profitGradient)" rx="2"/>
                                <rect x="230" y="150" width="25" height="25" fill="url(#lossGradient)" rx="2"/>
                                <rect x="270" y="90" width="25" height="60" fill="url(#profitGradient)" rx="2"/>
                                <rect x="310" y="70" width="25" height="80" fill="url(#profitGradient)" rx="2"/>
                                <rect x="350" y="130" width="25" height="20" fill="url(#profitGradient)" rx="2"/>
                                <rect x="390" y="100" width="25" height="50" fill="url(#profitGradient)" rx="2"/>
                                <rect x="430" y="85" width="25" height="65" fill="url(#profitGradient)" rx="2"/>
                            </svg>
                            <div class="absolute bottom-4 left-4">
                                <div class="hologram-text text-sm text-blade-amber/80">DAILY P&L (14 DAYS)</div>
                            </div>
                        </div>
                        
                        <!-- Strategy Breakdown -->
                        <div class="chart-container h-80 rounded relative overflow-hidden flex items-center justify-center">
                            <svg class="w-64 h-64" viewBox="0 0 200 200">
                                <defs>
                                    <filter id="pieGlow">
                                        <feGaussianBlur stdDeviation="2" result="coloredBlur"/>
                                        <feMerge> 
                                            <feMergeNode in="coloredBlur"/>
                                            <feMergeNode in="SourceGraphic"/>
                                        </feMerge>
                                    </filter>
                                </defs>
                                <!-- Donut chart segments -->
                                <circle cx="100" cy="100" r="70" fill="none" stroke="#00e5ff" stroke-width="20" 
                                        stroke-dasharray="220 440" stroke-dashoffset="0" filter="url(#pieGlow)" opacity="0.8"/>
                                <circle cx="100" cy="100" r="70" fill="none" stroke="#ff8c00" stroke-width="20" 
                                        stroke-dasharray="132 440" stroke-dashoffset="-220" filter="url(#pieGlow)" opacity="0.8"/>
                                <circle cx="100" cy="100" r="70" fill="none" stroke="#ffab00" stroke-width="20" 
                                        stroke-dasharray="88 440" stroke-dashoffset="-352" filter="url(#pieGlow)" opacity="0.8"/>
                                <!-- Center text -->
                                <text x="100" y="95" text-anchor="middle" class="hologram-text text-xs" fill="#ff8c00">STRATEGY</text>
                                <text x="100" y="110" text-anchor="middle" class="hologram-text text-xs" fill="#00e5ff">BREAKDOWN</text>
                            </svg>
                            <div class="absolute bottom-4 left-4 space-y-2">
                                <div class="flex items-center space-x-2">
                                    <div class="w-3 h-3 bg-cyan-glow rounded"></div>
                                    <span class="hologram-text text-xs text-blade-amber/80">SNIPING 50%</span>
                                </div>
                                <div class="flex items-center space-x-2">
                                    <div class="w-3 h-3 bg-blade-amber rounded"></div>
                                    <span class="hologram-text text-xs text-blade-amber/80">ARBITRAGE 30%</span>
                                </div>
                                <div class="flex items-center space-x-2">
                                    <div class="w-3 h-3 bg-blade-yellow rounded"></div>
                                    <span class="hologram-text text-xs text-blade-amber/80">MARKET MAKING 20%</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Market Data Chart -->
                <div class="chart-panel hologram-panel p-6 rounded scan-lines hidden" id="marketChart">
                    <div class="flex justify-between items-center mb-6">
                        <h3 class="text-lg font-semibold text-white hologram-text tracking-wider">
                            ACTIVE MARKET DATA
                        </h3>
                        <div class="flex space-x-2">
                            <button class="market-symbol px-3 py-1 bg-blade-amber/20 text-blade-amber rounded text-xs hologram-text border border-blade-amber/50">SOL/USDC</button>
                            <button class="market-symbol px-3 py-1 bg-void-black/50 text-blade-amber/60 rounded text-xs hologram-text border border-blade-amber/20">RAY/SOL</button>
                            <button class="market-symbol px-3 py-1 bg-void-black/50 text-blade-amber/60 rounded text-xs hologram-text border border-blade-amber/20">ORCA/USDC</button>
                            <button class="px-3 py-1 bg-void-black/50 text-blade-amber/60 rounded text-xs hologram-text border border-blade-amber/20" id="openTradingView">TRADINGVIEW</button>
                        </div>
                    </div>
                    <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
                        <!-- Main Price Chart -->
                        <div class="lg:col-span-2 chart-container h-80 rounded relative overflow-hidden">
                            <svg class="w-full h-full" viewBox="0 0 800 300">
                                <defs>
                                    <linearGradient id="marketGradient" x1="0%" y1="0%" x2="0%" y2="100%">
                                        <stop offset="0%" stop-color="#ff8c00" stop-opacity="0.4" />
                                        <stop offset="50%" stop-color="#00e5ff" stop-opacity="0.2" />
                                        <stop offset="100%" stop-color="#ff8c00" stop-opacity="0.1" />
                                    </linearGradient>
                                </defs>
                                <!-- Candlesticks -->
                                <g id="candlesticks">
                                    <!-- Green candles -->
                                    <rect x="50" y="180" width="8" height="40" fill="#00e5ff" opacity="0.8"/>
                                    <line x1="54" y1="160" x2="54" y2="230" stroke="#00e5ff" stroke-width="1"/>
                                    <rect x="100" y="160" width="8" height="50" fill="#00e5ff" opacity="0.8"/>
                                    <line x1="104" y1="140" x2="104" y2="220" stroke="#00e5ff" stroke-width="1"/>
                                    <!-- Red candles -->
                                    <rect x="150" y="170" width="8" height="30" fill="#ff6b35" opacity="0.8"/>
                                    <line x1="154" y1="150" x2="154" y2="210" stroke="#ff6b35" stroke-width="1"/>
                                    <rect x="200" y="190" width="8" height="35" fill="#ff6b35" opacity="0.8"/>
                                    <line x1="204" y1="175" x2="204" y2="235" stroke="#ff6b35" stroke-width="1"/>
                                </g>
                                <!-- Volume bars -->
                                <g id="volumeBars" transform="translate(0, 250)">
                                    <rect x="50" y="0" width="8" height="20" fill="#ff8c00" opacity="0.4"/>
                                    <rect x="100" y="0" width="8" height="35" fill="#ff8c00" opacity="0.4"/>
                                    <rect x="150" y="0" width="8" height="15" fill="#ff8c00" opacity="0.4"/>
                                    <rect x="200" y="0" width="8" height="25" fill="#ff8c00" opacity="0.4"/>
                                </g>
                            </svg>
                            <div class="absolute top-4 left-4">
                                <div class="hologram-text text-2xl amber-glow data-flicker" id="assetPrice">$0.00</div>
                                <div class="hologram-text text-sm cyan-glow" id="assetChange">+0.00 (+0.00%)</div>
                            </div>
                        </div>
                        
                        <!-- Market Stats -->
                        <div class="space-y-4">
                            <div class="bg-void-black/50 p-4 rounded border border-blade-amber/20">
                                <div class="hologram-text text-xs text-blade-amber/80 mb-1">24H VOLUME</div>
                                <div class="hologram-text text-lg amber-glow" id="volume24h">N/A</div>
                            </div>
                            <div class="bg-void-black/50 p-4 rounded border border-blade-cyan/20">
                                <div class="hologram-text text-xs text-blade-amber/80 mb-1">VOLATILITY</div>
                                <div class="hologram-text text-lg cyan-glow" id="volatility">N/A</div>
                            </div>
                            <div class="bg-void-black/50 p-4 rounded border border-blade-yellow/20">
                                <div class="hologram-text text-xs text-blade-amber/80 mb-1">LIQUIDITY</div>
                                <div class="hologram-text text-lg text-blade-yellow" id="marketLiquidity">N/A</div>
                            </div>
                            <div class="bg-void-black/50 p-4 rounded border border-blade-orange/20">
                                <div class="hologram-text text-xs text-blade-amber/80 mb-1">SPREAD</div>
                                <div class="hologram-text text-lg text-blade-orange" id="spread">N/A</div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Regime Analysis Chart -->
                <div class="chart-panel hologram-panel p-6 rounded scan-lines hidden" id="regimeChart">
                    <div class="flex justify-between items-center mb-6">
                        <h3 class="text-lg font-semibold text-white hologram-text tracking-wider">
                            MARKET REGIME ANALYSIS
                        </h3>
                        <div class="flex space-x-2">
                            <button class="px-3 py-1 bg-blade-amber/20 text-blade-amber rounded text-xs hologram-text border border-blade-amber/50">LIVE</button>
                            <button class="px-3 py-1 bg-void-black/50 text-blade-amber/60 rounded text-xs hologram-text border border-blade-amber/20">HISTORY</button>
                        </div>
                    </div>
                    <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                        <!-- Regime Probability Chart -->
                        <div class="chart-container h-80 rounded relative overflow-hidden">
                            <svg class="w-full h-full" viewBox="0 0 500 300">
                                <defs>
                                    <linearGradient id="trendGradient" x1="0%" y1="0%" x2="0%" y2="100%">
                                        <stop offset="0%" stop-color="#00e5ff" stop-opacity="0.6" />
                                        <stop offset="100%" stop-color="#00e5ff" stop-opacity="0.1" />
                                    </linearGradient>
                                    <linearGradient id="meanRevertGradient" x1="0%" y1="0%" x2="0%" y2="100%">
                                        <stop offset="0%" stop-color="#ff8c00" stop-opacity="0.6" />
                                        <stop offset="100%" stop-color="#ff8c00" stop-opacity="0.1" />
                                    </linearGradient>
                                    <linearGradient id="chopGradient" x1="0%" y1="0%" x2="0%" y2="100%">
                                        <stop offset="0%" stop-color="#ffab00" stop-opacity="0.6" />
                                        <stop offset="100%" stop-color="#ffab00" stop-opacity="0.1" />
                                    </linearGradient>
                                </defs>
                                <!-- Grid -->
                                <g stroke="rgba(255, 140, 0, 0.1)" stroke-width="0.5">
                                    <line x1="0" y1="75" x2="500" y2="75"/>
                                    <line x1="0" y1="150" x2="500" y2="150"/>
                                    <line x1="0" y1="225" x2="500" y2="225"/>
                                </g>
                                <!-- Regime areas -->
                                <path d="M 0 300 Q 100 250 200 200 T 400 150 T 500 120 L 500 300 Z" fill="url(#trendGradient)"/>
                                <path d="M 0 300 Q 100 280 200 260 T 400 240 T 500 220 L 500 300 Z" fill="url(#meanRevertGradient)"/>
                                <path d="M 0 300 Q 100 290 200 285 T 400 280 T 500 275 L 500 300 Z" fill="url(#chopGradient)"/>
                                <!-- Regime lines -->
                                <path d="M 0 200 Q 100 180 200 150 T 400 120 T 500 100" stroke="#00e5ff" stroke-width="3" fill="none" filter="url(#equityGlow)"/>
                                <path d="M 0 250 Q 100 240 200 220 T 400 200 T 500 180" stroke="#ff8c00" stroke-width="3" fill="none" filter="url(#equityGlow)"/>
                                <path d="M 0 280 Q 100 275 200 270 T 400 265 T 500 260" stroke="#ffab00" stroke-width="3" fill="none" filter="url(#equityGlow)"/>
                            </svg>
                            <div class="absolute bottom-4 left-4 space-y-1">
                                <div class="flex items-center space-x-2">
                                    <div class="w-3 h-1 bg-cyan-glow rounded"></div>
                                    <span class="hologram-text text-xs text-blade-amber/80">TREND 68%</span>
                                </div>
                                <div class="flex items-center space-x-2">
                                    <div class="w-3 h-1 bg-blade-amber rounded"></div>
                                    <span class="hologram-text text-xs text-blade-amber/80">MEAN-REVERT 22%</span>
                                </div>
                                <div class="flex items-center space-x-2">
                                    <div class="w-3 h-1 bg-blade-yellow rounded"></div>
                                    <span class="hologram-text text-xs text-blade-amber/80">CHOP 10%</span>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Triangular Regime Meter -->
                        <div class="space-y-6">
                            <div class="text-center">
                                <div class="hologram-text text-sm text-blade-amber/80 mb-4">MARKET REGIME ANALYSIS</div>
                                
                                <!-- Triangular Regime Gauge -->
                                <div class="relative w-48 h-48 mx-auto mb-6">
                                    <svg class="w-full h-full" viewBox="0 0 200 200" id="regimeTriangle">
                                        <defs>
                                            <filter id="triangleGlow">
                                                <feGaussianBlur stdDeviation="3" result="coloredBlur"/>
                                                <feMerge> 
                                                    <feMergeNode in="coloredBlur"/>
                                                    <feMergeNode in="SourceGraphic"/>
                                                </feMerge>
                                            </filter>
                                            <linearGradient id="trendRegion" x1="0%" y1="0%" x2="100%" y2="100%">
                                                <stop offset="0%" stop-color="#00e5ff" stop-opacity="0.3" />
                                                <stop offset="100%" stop-color="#00e5ff" stop-opacity="0.1" />
                                            </linearGradient>
                                            <linearGradient id="revertRegion" x1="0%" y1="0%" x2="100%" y2="100%">
                                                <stop offset="0%" stop-color="#ff8c00" stop-opacity="0.3" />
                                                <stop offset="100%" stop-color="#ff8c00" stop-opacity="0.1" />
                                            </linearGradient>
                                            <linearGradient id="chopRegion" x1="0%" y1="0%" x2="100%" y2="100%">
                                                <stop offset="0%" stop-color="#ffab00" stop-opacity="0.3" />
                                                <stop offset="100%" stop-color="#ffab00" stop-opacity="0.1" />
                                            </linearGradient>
                                        </defs>
                                        
                                        <!-- Triangle regions -->
                                        <path d="M 100 30 L 170 150 L 100 120 Z" fill="url(#trendRegion)" stroke="#00e5ff" stroke-width="2" opacity="0.8"/>
                                        <path d="M 100 30 L 30 150 L 100 120 Z" fill="url(#revertRegion)" stroke="#ff8c00" stroke-width="2" opacity="0.8"/>
                                        <path d="M 30 150 L 170 150 L 100 120 Z" fill="url(#chopRegion)" stroke="#ffab00" stroke-width="2" opacity="0.8"/>
                                        
                                        <!-- Center point -->
                                        <circle cx="100" cy="120" r="3" fill="#ffffff" opacity="0.8"/>
                                        
                                        <!-- Regime needle -->
                                        <line id="regimeNeedle" x1="100" y1="120" x2="130" y2="80" stroke="#ffffff" stroke-width="3" 
                                              filter="url(#triangleGlow)" opacity="0.9">
                                            <animateTransform attributeName="transform" attributeType="XML" type="rotate" 
                                                            values="0 100 120;10 100 120;-5 100 120;0 100 120" 
                                                            dur="4s" repeatCount="indefinite"/>
                                        </line>
                                        
                                        <!-- Labels -->
                                        <text x="100" y="25" text-anchor="middle" class="hologram-text text-xs" fill="#00e5ff">TREND</text>
                                        <text x="25" y="165" text-anchor="middle" class="hologram-text text-xs" fill="#ff8c00">REVERT</text>
                                        <text x="175" y="165" text-anchor="middle" class="hologram-text text-xs" fill="#ffab00">CHOP</text>
                                    </svg>
                                </div>
                                
                                <!-- Current Regime Display -->
                                <div class="hologram-text text-2xl cyan-glow data-flicker mb-2">TRENDING REGIME</div>
                                <div class="hologram-text text-sm text-blade-amber/60">CONFIDENCE: 68% • STRENGTH: HIGH</div>
                            </div>
                            
                            <!-- Regime Probability Bars -->
                            <div class="space-y-3">
                                <div class="tooltip-trigger relative">
                                    <div class="flex justify-between items-center mb-2">
                                        <div class="flex items-center space-x-2">
                                            <div class="w-3 h-3 bg-cyan-glow rounded-full regime-pulse"></div>
                                            <span class="hologram-text text-xs text-blade-amber/80">TREND PROBABILITY</span>
                                        </div>
                                        <span class="hologram-text text-xs cyan-glow font-bold">68%</span>
                                    </div>
                                    <div class="w-full bg-void-black rounded-full h-2 relative overflow-hidden">
                                        <div class="bg-gradient-to-r from-cyan-glow to-blade-cyan h-2 rounded-full transition-all duration-1000 w-[68%]"></div>
                                        <div class="absolute inset-0 bg-gradient-to-r from-transparent via-white/20 to-transparent animate-pulse"></div>
                                    </div>
                                    <div class="tooltip absolute bottom-full mb-2 px-3 py-2 text-xs rounded left-0">
                                        TREND: 68% - The model estimates a 68% probability<br/>
                                        the market is in an upward trending regime.<br/>
                                        Strategy: Aggressive momentum trades active.
                                    </div>
                                </div>
                                
                                <div class="tooltip-trigger relative">
                                    <div class="flex justify-between items-center mb-2">
                                        <div class="flex items-center space-x-2">
                                            <div class="w-3 h-3 bg-blade-amber rounded-full"></div>
                                            <span class="hologram-text text-xs text-blade-amber/80">MEAN-REVERT PROBABILITY</span>
                                        </div>
                                        <span class="hologram-text text-xs text-blade-amber font-bold">22%</span>
                                    </div>
                                    <div class="w-full bg-void-black rounded-full h-2">
                                        <div class="bg-gradient-to-r from-blade-amber to-blade-orange h-2 rounded-full transition-all duration-1000 w-[22%]"></div>
                                    </div>
                                    <div class="tooltip absolute bottom-full mb-2 px-3 py-2 text-xs rounded left-0">
                                        MEAN-REVERT: 22% - Low probability of mean-reverting<br/>
                                        market conditions. Range-bound trading strategies<br/>
                                        are currently de-emphasized.
                                    </div>
                                </div>
                                
                                <div class="tooltip-trigger relative">
                                    <div class="flex justify-between items-center mb-2">
                                        <div class="flex items-center space-x-2">
                                            <div class="w-3 h-3 bg-blade-yellow rounded-full"></div>
                                            <span class="hologram-text text-xs text-blade-amber/80">CHOP PROBABILITY</span>
                                        </div>
                                        <span class="hologram-text text-xs text-blade-yellow font-bold">10%</span>
                                    </div>
                                    <div class="w-full bg-void-black rounded-full h-2">
                                        <div class="bg-gradient-to-r from-blade-yellow to-blade-amber h-2 rounded-full transition-all duration-1000 w-[10%]"></div>
                                    </div>
                                    <div class="tooltip absolute bottom-full mb-2 px-3 py-2 text-xs rounded left-0">
                                        CHOP: 10% - Very low probability of choppy,<br/>
                                        sideways market movement. High-frequency<br/>
                                        strategies are minimized.
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Strategy & Model Insights -->
                <div class="grid grid-cols-1 xl:grid-cols-3 lg:grid-cols-2 gap-6">
                    <!-- Whale Tracker -->
                    <div class="hologram-panel p-6 rounded scan-lines">
                        <div class="flex items-center justify-between mb-6">
                            <h3 class="text-lg font-semibold text-white hologram-text tracking-wider">
                                WHALE TRACKER
                            </h3>
                            <div class="flex items-center space-x-2">
                                <div class="w-2 h-2 bg-cyan-glow rounded-full animate-pulse"></div>
                                <span class="hologram-text text-xs cyan-glow">LIVE HUNT</span>
                            </div>
                        </div>
                        
                        <div class="space-y-3">
                            <div id="whaleAlerts" class="space-y-3">
                                <div id="copyTradingSpinner" class="hologram-text text-blade-amber/60 text-xs animate-pulse">LOADING...</div>
                            </div>

                              <!-- Smart Money Flow -->
                              <div class="bg-void-black/50 p-3 rounded border border-blade-yellow/30">
                                  <div class="flex items-center justify-between mb-2">
                                      <div class="hologram-text text-blade-yellow font-bold text-sm">SMART MONEY FLOW</div>
                                      <div class="hologram-text text-cyan-glow text-sm animate-pulse" id="smartMoneyValue">--</div>
                                  </div>
                                  <div class="flex justify-between text-xs">
                                      <span class="hologram-text text-blade-amber/60">Last 1H Net Inflow</span>
                                      <span class="hologram-text text-cyan-glow animate-pulse" id="smartMoneyTrend">--</span>
                                  </div>
                              </div>

                              <!-- Copy Trading Stats -->
                              <div class="bg-void-black/50 p-3 rounded border border-blade-amber/30">
                                  <div class="hologram-text text-blade-amber font-bold text-sm mb-2">COPY TRADING STATS</div>
                                  <div class="grid grid-cols-2 gap-3 text-xs">
                                      <div>
                                          <div class="hologram-text text-blade-amber/80">FOLLOWING</div>
                                          <div class="hologram-text text-white font-bold animate-pulse" id="whaleFollowing">-</div>
                                      </div>
                                      <div>
                                          <div class="hologram-text text-blade-amber/80">SUCCESS RATE</div>
                                          <div class="hologram-text text-cyan-glow font-bold animate-pulse" id="whaleSuccessRate">-</div>
                                      </div>
                                      <div>
                                          <div class="hologram-text text-blade-amber/80">COPIED TODAY</div>
                                          <div class="hologram-text text-white font-bold animate-pulse" id="whaleCopiedToday">-</div>
                                      </div>
                                      <div>
                                          <div class="hologram-text text-blade-amber/80">PROFIT</div>
                                          <div class="hologram-text text-cyan-glow font-bold animate-pulse" id="whaleProfit">-</div>
                                      </div>
                                  </div>
                              </div>
                        </div>
                    </div>

                    <!-- AI Strategy Command Center -->
                    <div class="hologram-panel p-6 rounded scan-lines">
                        <div class="flex items-center justify-between mb-6">
                            <h3 class="text-lg font-semibold text-white hologram-text tracking-wider">
                                NEURAL STRATEGY MATRIX
                            </h3>
                            <div class="flex items-center space-x-2">
                                <div class="w-2 h-2 bg-cyan-glow rounded-full animate-pulse"></div>
                                <span class="hologram-text text-xs cyan-glow">QUANTUM SYNC</span>
                            </div>
                        </div>
                        
                        <div id="strategyMatrix" class="space-y-4"></div>
                      </div>

                      <!-- Arbitrage Quantum -->
                      <div class="hologram-panel p-6 rounded scan-lines" id="arbitrageCard">
                          <div class="flex items-center justify-between mb-6">
                              <h3 class="text-lg font-semibold text-white hologram-text tracking-wider">ARBITRAGE QUANTUM</h3>
                              <div class="flex items-center space-x-2">
                                  <div class="w-2 h-2 bg-blade-amber rounded-full" id="arbStatusDot"></div>
                                  <span class="hologram-text text-xs text-blade-amber" id="arbStatusText">--</span>
                              </div>
                          </div>
                          <div class="grid grid-cols-2 lg:grid-cols-3 gap-4 text-xs">
                              <div>
                                  <div class="hologram-text text-blade-amber/80">TRADES</div>
                                  <div class="hologram-text text-white font-bold" id="arbTrades">-</div>
                              </div>
                              <div>
                                  <div class="hologram-text text-blade-amber/80">PNL</div>
                                  <div class="hologram-text text-cyan-glow font-bold" id="arbPnL">-</div>
                              </div>
                              <div>
                                  <div class="hologram-text text-blade-amber/80">SPREAD</div>
                                  <div class="hologram-text text-white font-bold" id="arbSpread">-</div>
                              </div>
                              <div>
                                  <div class="hologram-text text-blade-amber/80">OPPORTUNITIES</div>
                                  <div class="hologram-text text-white font-bold" id="arbOpps">-</div>
                              </div>
                              <div>
                                  <div class="hologram-text text-blade-amber/80">LATENCY</div>
                                  <div class="hologram-text text-white font-bold" id="arbLatency">-</div>
                              </div>
                          </div>
                      </div>

                      <!-- Strategy Performance -->
                      <div class="hologram-panel p-6 rounded scan-lines" id="strategyPerformancePanel">
                          <div class="flex items-center justify-between mb-6">
                              <h3 class="text-lg font-semibold text-white hologram-text tracking-wider">STRATEGY PERFORMANCE</h3>
                              <div class="flex space-x-2">
                                  <button class="strategy-period px-3 py-1 bg-blade-amber/20 text-blade-amber rounded text-xs hologram-text border border-blade-amber/50" data-period="7d">7D</button>
                                  <button class="strategy-period px-3 py-1 bg-void-black/50 text-blade-amber/60 rounded text-xs hologram-text border border-blade-amber/20" data-period="30d">30D</button>
                              </div>
                          </div>
                          <div id="strategyPerformance" class="grid grid-cols-2 gap-4 text-xs"></div>
                      </div>

                      <!-- Strategy Breakdown -->
                      <div class="hologram-panel p-6 rounded scan-lines" id="strategyBreakdownPanel">
                          <h3 class="text-lg font-semibold text-white hologram-text tracking-wider mb-6">STRATEGY BREAKDOWN</h3>
                          <div id="strategyBreakdown" class="space-y-4"></div>
                      </div>

                      <!-- Risk Analytics -->
                      <div class="hologram-panel p-6 rounded scan-lines" id="riskAnalyticsPanel">
                          <h3 class="text-lg font-semibold text-white hologram-text tracking-wider mb-6">RISK ANALYTICS</h3>
                          <div id="riskAnalytics" class="grid grid-cols-2 gap-4 text-xs"></div>
                      </div>

                      <!-- MEV Protection & Alpha Signals -->
                    <div class="hologram-panel p-6 rounded scan-lines">
                        <div class="flex justify-between items-center mb-6">
                            <h3 class="text-lg font-semibold text-white hologram-text tracking-wider">
                                MEV SHIELD & ALPHA SIGNALS
                            </h3>
                            <div class="flex items-center space-x-2">
                                <div class="w-2 h-2 bg-cyan-glow rounded-full animate-pulse"></div>
                                <span class="hologram-text text-xs cyan-glow">PROTECTED</span>
                            </div>
                        </div>
                        
                        <div class="space-y-4">
                            <!-- MEV Protection Status -->
                            <div class="bg-void-black/50 p-4 rounded border border-blade-cyan/30">
                                <div class="flex items-center justify-between mb-3">
                                    <div class="flex items-center space-x-3">
                                        <svg class="w-8 h-8" viewBox="0 0 32 32">
                                            <defs>
                                                <filter id="shieldGlow2">
                                                    <feGaussianBlur stdDeviation="2" result="coloredBlur"/>
                                                    <feMerge> 
                                                        <feMergeNode in="coloredBlur"/>
                                                        <feMergeNode in="SourceGraphic"/>
                                                    </feMerge>
                                                </filter>
                                            </defs>
                                            <path d="M16 2 L26 8 L26 18 Q26 26 16 30 Q6 26 6 18 L6 8 Z" 
                                                  fill="none" stroke="#00e5ff" stroke-width="2" filter="url(#shieldGlow2)"/>
                                            <circle cx="16" cy="16" r="6" fill="none" stroke="#00e5ff" stroke-width="1" opacity="0.6"/>
                                            <circle cx="16" cy="16" r="3" fill="#00e5ff" opacity="0.8"/>
                                        </svg>
                                        <div>
                                            <div class="hologram-text text-cyan-glow font-bold">MEV PROTECTION ACTIVE</div>
                                            <div class="hologram-text text-xs text-blade-amber/80">Quantum Anti-Sandwich Defense</div>
                                        </div>
                                    </div>
                                    <div class="text-right">
                                        <div class="hologram-text text-cyan-glow font-bold">$2,847</div>
                                        <div class="hologram-text text-xs text-blade-amber/60">SAVED TODAY</div>
                                    </div>
                                </div>
                                <div class="grid grid-cols-3 gap-3 text-xs">
                                    <div>
                                        <div class="hologram-text text-blade-amber/80">ATTACKS BLOCKED</div>
                                        <div class="hologram-text text-cyan-glow font-bold">47</div>
                                    </div>
                                    <div>
                                        <div class="hologram-text text-blade-amber/80">SUCCESS RATE</div>
                                        <div class="hologram-text text-cyan-glow font-bold">99.2%</div>
                                    </div>
                                    <div>
                                        <div class="hologram-text text-blade-amber/80">LATENCY</div>
                                        <div class="hologram-text text-cyan-glow font-bold">3ms</div>
                                    </div>
                                </div>
                            </div>

                            <!-- Alpha Signal Generator -->
                            <div class="bg-void-black/50 p-4 rounded border border-blade-amber/30">
                                <div class="flex items-center justify-between mb-3">
                                    <div class="flex items-center space-x-3">
                                        <div class="relative">
                                            <svg class="w-6 h-6" viewBox="0 0 24 24" fill="none">
                                                <path d="M12 2l2.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z" fill="#ff8c00"/>
                                            </svg>
                                            <div class="absolute inset-0 animate-spin">
                                                <svg class="w-6 h-6" viewBox="0 0 24 24" fill="none">
                                                    <circle cx="12" cy="12" r="10" stroke="#ff8c00" stroke-width="1" stroke-dasharray="31.416" stroke-dashoffset="15.708" opacity="0.3"/>
                                                </svg>
                                            </div>
                                        </div>
                                        <div>
                                            <div class="hologram-text text-blade-amber font-bold">ALPHA SIGNAL GENERATOR</div>
                                            <div class="hologram-text text-xs text-blade-amber/80">Multi-Source Intelligence Fusion</div>
                                        </div>
                                    </div>
                                    <div class="text-right">
                                        <div class="hologram-text text-blade-amber font-bold">STRONG</div>
                                        <div class="hologram-text text-xs text-blade-amber/60">SIGNAL STRENGTH</div>
                                    </div>
                                </div>
                                <div class="space-y-2">
                                    <div class="flex justify-between text-xs">
                                        <span class="hologram-text text-blade-amber/80">SOCIAL SENTIMENT</span>
                                        <span class="hologram-text text-cyan-glow">BULLISH (8.2/10)</span>
                                    </div>
                                    <div class="flex justify-between text-xs">
                                        <span class="hologram-text text-blade-amber/80">ON-CHAIN MOMENTUM</span>
                                        <span class="hologram-text text-cyan-glow">STRONG (7.8/10)</span>
                                    </div>
                                    <div class="flex justify-between text-xs">
                                        <span class="hologram-text text-blade-amber/80">WHALE ACTIVITY</span>
                                        <span class="hologram-text text-blade-yellow">MODERATE (6.1/10)</span>
                                    </div>
                                </div>
                            </div>

                            <!-- Upcoming Catalysts -->
                            <div class="bg-void-black/50 p-4 rounded border border-blade-yellow/30">
                                <div class="hologram-text text-blade-yellow font-bold mb-3">UPCOMING CATALYSTS</div>
                                <div id="catalystList" class="space-y-2 text-xs"></div>
                            </div>

                            <!-- Flash Loan Opportunities -->
                            <div class="bg-void-black/50 p-4 rounded border border-blade-orange/30">
                                <div class="hologram-text text-blade-orange font-bold mb-3">FLASH LOAN OPPORTUNITIES</div>
                                <div class="space-y-2">
                                    <div class="flex justify-between items-center text-xs">
                                        <span class="hologram-text text-blade-amber/80">ACTIVE OPPORTUNITIES</span>
                                        <span class="hologram-text text-blade-orange font-bold">3 LIVE</span>
                                    </div>
                                    <div class="flex justify-between items-center text-xs">
                                        <span class="hologram-text text-blade-amber/80">POTENTIAL PROFIT</span>
                                        <span class="hologram-text text-cyan-glow font-bold">+0.34 SOL</span>
                                    </div>
                                    <div class="flex justify-between items-center text-xs">
                                        <span class="hologram-text text-blade-amber/80">EXECUTION TIME</span>
                                        <span class="hologram-text text-white font-bold">< 1 SLOT</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Enhanced Trading Feed with Social Sentiment -->
                <div class="grid grid-cols-1 xl:grid-cols-2 gap-6 mt-8">
                    <!-- Neural Trading Feed -->
                    <div class="hologram-panel p-6 rounded scan-lines">
                        <div class="flex justify-between items-center mb-6">
                            <h3 class="text-lg font-semibold text-white hologram-text tracking-wider">
                                NEURAL TRADING FEED
                            </h3>
                            <button class="text-xs hologram-text text-blade-amber/60 hover:text-blade-amber border border-blade-amber/30 px-3 py-1 rounded" id="pauseFeed">
                                PAUSE
                            </button>
                        </div>
                        <div class="feed-scroll space-y-2" id="tradingFeed">
                            <div id="feedPlaceholder" class="hologram-text text-blade-amber/60 text-sm">
                                No trading activity yet.
                            </div>
                        </div>
                    </div>

                    <!-- Social Sentiment & Community Intel -->
                    <div class="hologram-panel p-6 rounded scan-lines">
                        <div class="flex justify-between items-center mb-6">
                            <h3 class="text-lg font-semibold text-white hologram-text tracking-wider">
                                SOCIAL SENTIMENT MATRIX
                            </h3>
                            <div class="flex items-center space-x-2">
                                <div class="w-2 h-2 bg-blade-amber rounded-full animate-pulse"></div>
                                <span class="hologram-text text-xs text-blade-amber">SCANNING</span>
                            </div>
                        </div>
                        
                        <div class="space-y-4">
                              <!-- Trending Tokens -->
                              <div class="bg-void-black/50 p-4 rounded border border-blade-cyan/30">
                                  <div class="hologram-text text-cyan-glow font-bold mb-3">TRENDING NOW</div>
                                  <div id="trendingTokens" class="space-y-2 text-xs"></div>
                              </div>

                              <!-- Influencer Alerts -->
                              <div class="bg-void-black/50 p-4 rounded border border-blade-yellow/30">
                                  <div class="hologram-text text-blade-yellow font-bold mb-3">INFLUENCER ALERTS</div>
                                  <div id="influencerAlerts" class="space-y-2 text-xs"></div>
                              </div>

                              <!-- Community Sentiment Gauge -->
                              <div class="bg-void-black/50 p-4 rounded border border-blade-amber/30">
                                  <div class="hologram-text text-blade-amber font-bold mb-3">COMMUNITY PULSE</div>
                                  <div class="space-y-3">
                                      <div>
                                          <div class="flex justify-between items-center mb-1">
                                              <span class="hologram-text text-blade-amber/80 text-xs">FEAR & GREED INDEX</span>
                                              <span class="hologram-text text-cyan-glow text-xs font-bold" id="fearGreedValue">--</span>
                                          </div>
                                          <div class="w-full bg-void-black rounded-full h-2 relative overflow-hidden">
                                              <div class="bg-gradient-to-r from-blade-orange via-blade-yellow to-cyan-glow h-2 rounded-full" id="fearGreedBar" style="width:0%"></div>
                                              <div class="absolute inset-0 bg-gradient-to-r from-transparent via-white/20 to-transparent animate-pulse"></div>
                                          </div>
                                      </div>

                                      <div>
                                          <div class="flex justify-between items-center mb-1">
                                              <span class="hologram-text text-blade-amber/80 text-xs">SOCIAL VOLUME</span>
                                              <span class="hologram-text text-blade-amber text-xs font-bold" id="socialVolumeValue">--</span>
                                          </div>
                                          <div class="w-full bg-void-black rounded-full h-2 relative overflow-hidden">
                                              <div class="bg-gradient-to-r from-blade-amber to-blade-yellow h-2 rounded-full" id="socialVolumeBar" style="width:0%"></div>
                                              <div class="absolute inset-0 bg-gradient-to-r from-transparent via-white/20 to-transparent animate-pulse"></div>
                                          </div>
                                      </div>

                                      <div>
                                          <div class="flex justify-between items-center mb-1">
                                              <span class="hologram-text text-blade-amber/80 text-xs">FOMO INTENSITY</span>
                                              <span class="hologram-text text-blade-orange text-xs font-bold" id="fomoValue">--</span>
                                          </div>
                                          <div class="w-full bg-void-black rounded-full h-2 relative overflow-hidden">
                                              <div class="bg-gradient-to-r from-blade-yellow to-blade-orange h-2 rounded-full" id="fomoBar" style="width:0%"></div>
                                              <div class="absolute inset-0 bg-gradient-to-r from-transparent via-white/20 to-transparent animate-pulse"></div>
                                          </div>
                                      </div>
                                  </div>
                              </div>

                              <!-- News & Events -->
                              <div class="bg-void-black/50 p-4 rounded border border-blade-cyan/30">
                                  <div class="hologram-text text-cyan-glow font-bold mb-3">BREAKING NEWS</div>
                                  <div id="newsFeed" class="space-y-2 text-xs"></div>
                              </div>
                        </div>
                    </div>
                </div>

                <!-- Performance Analytics & Backtesting -->
                <div class="grid grid-cols-1 xl:grid-cols-2 gap-6 mt-8">
                    <!-- Strategy Performance Heatmap -->
                    <div class="hologram-panel p-6 rounded scan-lines">
                        <div class="flex justify-between items-center mb-6">
                            <h3 class="text-lg font-semibold text-white hologram-text tracking-wider">
                                STRATEGY PERFORMANCE MATRIX
                            </h3>
                            <div class="flex space-x-2">
                                <button class="px-3 py-1 bg-blade-amber/20 text-blade-amber rounded text-xs hologram-text border border-blade-amber/50">7D</button>
                                <button class="px-3 py-1 bg-void-black/50 text-blade-amber/60 rounded text-xs hologram-text border border-blade-amber/20">30D</button>
                            </div>
                        </div>
                        
                        <div class="space-y-4">
                            <!-- Performance Heatmap -->
                            <div class="grid grid-cols-7 gap-1">
                                <!-- Days of week header -->
                                <div class="text-xs hologram-text text-blade-amber/60 text-center">M</div>
                                <div class="text-xs hologram-text text-blade-amber/60 text-center">T</div>
                                <div class="text-xs hologram-text text-blade-amber/60 text-center">W</div>
                                <div class="text-xs hologram-text text-blade-amber/60 text-center">T</div>
                                <div class="text-xs hologram-text text-blade-amber/60 text-center">F</div>
                                <div class="text-xs hologram-text text-blade-amber/60 text-center">S</div>
                                <div class="text-xs hologram-text text-blade-amber/60 text-center">S</div>
                                
                                <!-- Week 1 -->
                                <div class="w-8 h-8 bg-cyan-glow/80 rounded tooltip-trigger relative">
                                    <div class="tooltip absolute bottom-full mb-2 px-2 py-1 text-xs rounded">+2.4 SOL</div>
                                </div>
                                <div class="w-8 h-8 bg-cyan-glow/60 rounded tooltip-trigger relative">
                                    <div class="tooltip absolute bottom-full mb-2 px-2 py-1 text-xs rounded">+1.8 SOL</div>
                                </div>
                                <div class="w-8 h-8 bg-blade-orange/40 rounded tooltip-trigger relative">
                                    <div class="tooltip absolute bottom-full mb-2 px-2 py-1 text-xs rounded">-0.3 SOL</div>
                                </div>
                                <div class="w-8 h-8 bg-cyan-glow/90 rounded tooltip-trigger relative">
                                    <div class="tooltip absolute bottom-full mb-2 px-2 py-1 text-xs rounded">+3.1 SOL</div>
                                </div>
                                <div class="w-8 h-8 bg-cyan-glow/70 rounded tooltip-trigger relative">
                                    <div class="tooltip absolute bottom-full mb-2 px-2 py-1 text-xs rounded">+2.0 SOL</div>
                                </div>
                                <div class="w-8 h-8 bg-blade-amber/50 rounded tooltip-trigger relative">
                                    <div class="tooltip absolute bottom-full mb-2 px-2 py-1 text-xs rounded">+0.8 SOL</div>
                                </div>
                                <div class="w-8 h-8 bg-blade-orange/60 rounded tooltip-trigger relative">
                                    <div class="tooltip absolute bottom-full mb-2 px-2 py-1 text-xs rounded">-0.5 SOL</div>
                                </div>
                                
                                <!-- Week 2 -->
                                <div class="w-8 h-8 bg-cyan-glow/50 rounded tooltip-trigger relative">
                                    <div class="tooltip absolute bottom-full mb-2 px-2 py-1 text-xs rounded">+1.2 SOL</div>
                                </div>
                                <div class="w-8 h-8 bg-cyan-glow/80 rounded tooltip-trigger relative">
                                    <div class="tooltip absolute bottom-full mb-2 px-2 py-1 text-xs rounded">+2.7 SOL</div>
                                </div>
                                <div class="w-8 h-8 bg-cyan-glow/60 rounded tooltip-trigger relative">
                                    <div class="tooltip absolute bottom-full mb-2 px-2 py-1 text-xs rounded">+1.9 SOL</div>
                                </div>
                                <div class="w-8 h-8 bg-blade-amber/40 rounded tooltip-trigger relative">
                                    <div class="tooltip absolute bottom-full mb-2 px-2 py-1 text-xs rounded">+0.4 SOL</div>
                                </div>
                                <div class="w-8 h-8 bg-cyan-glow/100 rounded tooltip-trigger relative">
                                    <div class="tooltip absolute bottom-full mb-2 px-2 py-1 text-xs rounded">+4.2 SOL</div>
                                </div>
                                <div class="w-8 h-8 bg-cyan-glow/70 rounded tooltip-trigger relative">
                                    <div class="tooltip absolute bottom-full mb-2 px-2 py-1 text-xs rounded">+2.1 SOL</div>
                                </div>
                                <div class="w-8 h-8 bg-blade-amber/30 rounded tooltip-trigger relative">
                                    <div class="tooltip absolute bottom-full mb-2 px-2 py-1 text-xs rounded">+0.2 SOL</div>
                                </div>
                            </div>
                            
                            <!-- Strategy Breakdown -->
                            <div class="grid grid-cols-3 gap-4">
                                <div class="bg-void-black/50 p-3 rounded border border-blade-cyan/30">
                                    <div class="hologram-text text-cyan-glow font-bold text-sm">SNIPER</div>
                                    <div class="hologram-text text-white text-lg">+12.4 SOL</div>
                                    <div class="hologram-text text-cyan-glow text-xs">94% Win Rate</div>
                                </div>
                                <div class="bg-void-black/50 p-3 rounded border border-blade-amber/30">
                                    <div class="hologram-text text-blade-amber font-bold text-sm">ARBITRAGE</div>
                                    <div class="hologram-text text-white text-lg">+8.7 SOL</div>
                                    <div class="hologram-text text-blade-amber text-xs">87% Win Rate</div>
                                </div>
                                <div class="bg-void-black/50 p-3 rounded border border-blade-yellow/30">
                                    <div class="hologram-text text-blade-yellow font-bold text-sm">MARKET MAKING</div>
                                    <div class="hologram-text text-white text-lg">+3.2 SOL</div>
                                    <div class="hologram-text text-blade-yellow text-xs">76% Win Rate</div>
                                </div>
                            </div>
                            
                            <!-- Risk Metrics -->
                            <div class="bg-void-black/50 p-4 rounded border border-blade-orange/30">
                                <div class="hologram-text text-blade-orange font-bold mb-3">RISK ANALYTICS</div>
                                <div class="grid grid-cols-2 gap-4 text-xs">
                                    <div>
                                        <div class="hologram-text text-blade-amber/80">SHARPE RATIO</div>
                                        <div class="hologram-text text-cyan-glow font-bold">2.84</div>
                                    </div>
                                    <div>
                                        <div class="hologram-text text-blade-amber/80">MAX DRAWDOWN</div>
                                        <div class="hologram-text text-blade-orange font-bold">-5.2%</div>
                                    </div>
                                    <div>
                                        <div class="hologram-text text-blade-amber/80">VOLATILITY</div>
                                        <div class="hologram-text text-white font-bold">12.4%</div>
                                    </div>
                                    <div>
                                        <div class="hologram-text text-blade-amber/80">CALMAR RATIO</div>
                                        <div class="hologram-text text-cyan-glow font-bold">4.67</div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- AI Backtesting Lab -->
                    <div class="hologram-panel p-6 rounded scan-lines">
                        <div class="flex justify-between items-center mb-6">
                            <h3 class="text-lg font-semibold text-white hologram-text tracking-wider">
                                AI BACKTESTING LAB
                            </h3>
                            <button class="px-3 py-1 bg-blade-cyan/20 text-cyan-glow rounded text-xs hologram-text border border-blade-cyan/50">
                                RUN TEST
                            </button>
                        </div>
                        
                        <div class="space-y-4">
                            <!-- Backtest Configuration -->
                            <div class="bg-void-black/50 p-4 rounded border border-blade-amber/30">
                                <div class="hologram-text text-blade-amber font-bold mb-3">TEST PARAMETERS</div>
                                <div class="space-y-3">
                                    <div>
                                        <label class="hologram-text text-blade-amber/80 text-xs block mb-1">TIME PERIOD</label>
                                        <select class="w-full bg-void-black border border-blade-amber/30 rounded px-2 py-1 hologram-text text-white text-xs">
                                            <option>Last 30 Days</option>
                                            <option>Last 90 Days</option>
                                            <option>Last 6 Months</option>
                                            <option>Custom Range</option>
                                        </select>
                                    </div>
                                    <div>
                                        <label class="hologram-text text-blade-amber/80 text-xs block mb-1">INITIAL CAPITAL</label>
                                        <input type="number" value="100" class="w-full bg-void-black border border-blade-amber/30 rounded px-2 py-1 hologram-text text-white text-xs" placeholder="SOL">
                                    </div>
                                    <div>
                                        <label class="hologram-text text-blade-amber/80 text-xs block mb-1">STRATEGY MIX</label>
                                        <div class="grid grid-cols-3 gap-2 text-xs">
                                            <div>
                                                <div class="hologram-text text-blade-amber/80">SNIPER</div>
                                                <input type="range" min="0" max="100" value="50" class="w-full h-1 bg-void-black rounded-lg appearance-none cursor-pointer slider">
                                            </div>
                                            <div>
                                                <div class="hologram-text text-blade-amber/80">ARB</div>
                                                <input type="range" min="0" max="100" value="30" class="w-full h-1 bg-void-black rounded-lg appearance-none cursor-pointer slider">
                                            </div>
                                            <div>
                                                <div class="hologram-text text-blade-amber/80">MM</div>
                                                <input type="range" min="0" max="100" value="20" class="w-full h-1 bg-void-black rounded-lg appearance-none cursor-pointer slider">
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Backtest Results -->
                            <div class="bg-void-black/50 p-4 rounded border border-blade-cyan/30">
                                <div class="hologram-text text-cyan-glow font-bold mb-3">SIMULATION RESULTS</div>
                                <div class="space-y-2">
                                    <div class="flex justify-between items-center">
                                        <span class="hologram-text text-blade-amber/80 text-xs">FINAL BALANCE</span>
                                        <span class="hologram-text text-cyan-glow font-bold">247.3 SOL</span>
                                    </div>
                                    <div class="flex justify-between items-center">
                                        <span class="hologram-text text-blade-amber/80 text-xs">TOTAL RETURN</span>
                                        <span class="hologram-text text-cyan-glow font-bold">+147.3%</span>
                                    </div>
                                    <div class="flex justify-between items-center">
                                        <span class="hologram-text text-blade-amber/80 text-xs">TOTAL TRADES</span>
                                        <span class="hologram-text text-white font-bold">1,247</span>
                                    </div>
                                    <div class="flex justify-between items-center">
                                        <span class="hologram-text text-blade-amber/80 text-xs">WIN RATE</span>
                                        <span class="hologram-text text-cyan-glow font-bold">89.2%</span>
                                    </div>
                                    <div class="flex justify-between items-center">
                                        <span class="hologram-text text-blade-amber/80 text-xs">AVG TRADE</span>
                                        <span class="hologram-text text-white font-bold">+0.12 SOL</span>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Monte Carlo Analysis -->
                            <div class="bg-void-black/50 p-4 rounded border border-blade-yellow/30">
                                <div class="hologram-text text-blade-yellow font-bold mb-3">MONTE CARLO ANALYSIS</div>
                                <div class="space-y-2 text-xs">
                                    <div class="flex justify-between items-center">
                                        <span class="hologram-text text-blade-amber/80">BEST CASE (95%)</span>
                                        <span class="hologram-text text-cyan-glow font-bold">+284.7 SOL</span>
                                    </div>
                                    <div class="flex justify-between items-center">
                                        <span class="hologram-text text-blade-amber/80">EXPECTED (50%)</span>
                                        <span class="hologram-text text-white font-bold">+147.3 SOL</span>
                                    </div>
                                    <div class="flex justify-between items-center">
                                        <span class="hologram-text text-blade-amber/80">WORST CASE (5%)</span>
                                        <span class="hologram-text text-blade-orange font-bold">+89.1 SOL</span>
                                    </div>
                                    <div class="flex justify-between items-center">
                                        <span class="hologram-text text-blade-amber/80">PROBABILITY OF PROFIT</span>
                                        <span class="hologram-text text-cyan-glow font-bold">97.8%</span>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Strategy Optimization -->
                            <div class="bg-void-black/50 p-4 rounded border border-blade-orange/30">
                                <div class="hologram-text text-blade-orange font-bold mb-3">AI OPTIMIZATION</div>
                                <div class="space-y-2 text-xs">
                                    <div class="hologram-text text-white">🎯 Increase Sniper allocation to 65% for +12% returns</div>
                                    <div class="hologram-text text-white">⚡ Reduce position size during high volatility periods</div>
                                    <div class="hologram-text text-white">🛡️ Add stop-loss at -15% for better risk management</div>
                                    <div class="hologram-text text-white">📊 Consider DCA strategy during market downturns</div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- System Settings Sidebar -->
    <div class="fixed top-0 right-0 h-full w-96 bg-glass-black border-l border-blade-amber/30 backdrop-filter backdrop-blur-lg transform translate-x-full transition-transform duration-300 z-50" id="settingsPanel">
        <div class="p-6 h-full overflow-y-auto">
            <div class="flex justify-between items-center mb-6">
                <h2 class="text-xl font-semibold text-white hologram-text tracking-wider">
                    SYSTEM HEALTH & SETTINGS
                </h2>
                <button class="text-blade-amber hover:text-white text-2xl" id="closeSettings">&times;</button>
            </div>
            
            <!-- System Health Section -->
            <div class="mb-8">
                <h3 class="text-lg font-semibold text-white hologram-text mb-4 tracking-wider">
                    SYSTEM HEALTH
                </h3>
                
                <!-- Resource Monitors -->
                <div class="bg-void-black/50 p-4 rounded border border-blade-amber/30 mb-4">
                    <h4 class="hologram-text text-blade-amber font-bold mb-3">RESOURCE USAGE</h4>
                    <div class="space-y-3">
                        <div class="tooltip-trigger relative">
                            <div class="flex justify-between items-center mb-1">
                                <span class="hologram-text text-blade-amber/80 text-sm">CPU USAGE</span>
                                <span class="hologram-text text-cyan-glow text-sm font-bold" id="cpuUsage">23.4%</span>
                            </div>
                            <div class="w-full bg-void-black rounded-full h-2 relative overflow-hidden">
                                <div class="bg-gradient-to-r from-cyan-glow to-blade-cyan h-2 rounded-full transition-all duration-1000 w-[23.4%]" id="cpuBar"></div>
                                <div class="absolute inset-0 bg-gradient-to-r from-transparent via-white/10 to-transparent animate-pulse"></div>
                            </div>
                            <div class="tooltip absolute bottom-full mb-2 px-3 py-2 text-xs rounded left-0">
                                CPU Usage: 23.4% of available cores<br/>
                                Process: sol-seeker-bot<br/>
                                Threads: 8 active<br/>
                                Status: Normal operation
                            </div>
                        </div>
                        
                        <div class="tooltip-trigger relative">
                            <div class="flex justify-between items-center mb-1">
                                <span class="hologram-text text-blade-amber/80 text-sm">MEMORY USAGE</span>
                                <span class="hologram-text text-blade-amber text-sm font-bold" id="memUsage">1.2GB</span>
                            </div>
                            <div class="w-full bg-void-black rounded-full h-2 relative overflow-hidden">
                                <div class="bg-gradient-to-r from-blade-amber to-blade-yellow h-2 rounded-full transition-all duration-1000 w-[45%]" id="memBar"></div>
                                <div class="absolute inset-0 bg-gradient-to-r from-transparent via-white/10 to-transparent animate-pulse"></div>
                            </div>
                            <div class="tooltip absolute bottom-full mb-2 px-3 py-2 text-xs rounded left-0">
                                Memory Usage: 1.2GB / 16GB available<br/>
                                Heap: 847MB<br/>
                                Cache: 312MB<br/>
                                Status: Optimal allocation
                            </div>
                        </div>
                        
                        <div class="tooltip-trigger relative">
                            <div class="flex justify-between items-center mb-1">
                                <span class="hologram-text text-blade-amber/80 text-sm">NETWORK LATENCY</span>
                                <span class="hologram-text text-cyan-glow text-sm font-bold" id="netLatency">12ms</span>
                            </div>
                            <div class="w-full bg-void-black rounded-full h-2 relative overflow-hidden">
                                <div class="bg-gradient-to-r from-cyan-glow to-blade-cyan h-2 rounded-full transition-all duration-1000 w-[85%]" id="netLatencyBar"></div>
                                <div class="absolute inset-0 bg-gradient-to-r from-transparent via-white/10 to-transparent animate-pulse"></div>
                            </div>
                            <div class="tooltip absolute bottom-full mb-2 px-3 py-2 text-xs rounded left-0">
                                RPC Latency: 12ms average<br/>
                                Provider: Helius (Primary)<br/>
                                WebSocket: 8ms<br/>
                                Status: Excellent connection
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Module Heartbeats -->
                <div class="bg-void-black/50 p-4 rounded border border-blade-cyan/30 mb-4">
                    <h4 class="hologram-text text-white font-bold mb-3">MODULE STATUS</h4>
                    <div class="space-y-2">
                        <div class="flex justify-between items-center tooltip-trigger relative">
                            <div class="flex items-center space-x-2">
                                <div class="w-2 h-2 bg-cyan-glow rounded-full status-online" id="moduleDataFeedDot"></div>
                                <span class="hologram-text text-blade-amber/80 text-sm">DATA FEED</span>
                            </div>
                            <span class="hologram-text text-cyan-glow text-xs" id="moduleDataFeed">SLOT #247891234</span>
                            <div class="tooltip absolute bottom-full mb-2 px-3 py-2 text-xs rounded right-0">
                                Data Feed: OPERATIONAL<br/>
                                Last slot: #247891234<br/>
                                Update rate: 400ms<br/>
                                Missed slots: 0
                            </div>
                        </div>
                        
                        <div class="flex justify-between items-center tooltip-trigger relative">
                            <div class="flex items-center space-x-2">
                                <div class="w-2 h-2 bg-cyan-glow rounded-full status-online" id="moduleInferenceEngineDot"></div>
                                <span class="hologram-text text-blade-amber/80 text-sm">INFERENCE ENGINE</span>
                            </div>
                            <span class="hologram-text text-cyan-glow text-xs" id="moduleInferenceEngine">4-SLOT CYCLE</span>
                            <div class="tooltip absolute bottom-full mb-2 px-3 py-2 text-xs rounded right-0">
                                Inference Engine: ACTIVE<br/>
                                Update interval: 4 slots<br/>
                                Last inference: 1.2s ago<br/>
                                Model accuracy: 94.2%
                            </div>
                        </div>
                        
                        <div class="flex justify-between items-center tooltip-trigger relative">
                            <div class="flex items-center space-x-2">
                                <div class="w-2 h-2 bg-cyan-glow rounded-full status-online" id="moduleRiskManagerDot"></div>
                                <span class="hologram-text text-blade-amber/80 text-sm">RISK MANAGER</span>
                            </div>
                            <span class="hologram-text text-cyan-glow text-xs" id="moduleRiskManager">MONITORING</span>
                            <div class="tooltip absolute bottom-full mb-2 px-3 py-2 text-xs rounded right-0">
                                Risk Manager: VIGILANT<br/>
                                Portfolio exposure: 78%<br/>
                                Risk checks: 2.1s intervals<br/>
                                Alerts: 0 active
                            </div>
                        </div>
                        
                        <div class="flex justify-between items-center tooltip-trigger relative">
                            <div class="flex items-center space-x-2">
                                <div class="w-2 h-2 bg-cyan-glow rounded-full status-online" id="moduleTradeExecutionDot"></div>
                                <span class="hologram-text text-blade-amber/80 text-sm">TRADE EXECUTION</span>
                            </div>
                            <span class="hologram-text text-cyan-glow text-xs" id="moduleTradeExecution">CONFIRMED 2S</span>
                            <div class="tooltip absolute bottom-full mb-2 px-3 py-2 text-xs rounded right-0">
                                Trade Execution: READY<br/>
                                Last trade: 2s ago<br/>
                                Success rate: 99.7%<br/>
                                Queue: 0 pending
                            </div>
                        </div>
                        
                        <div class="flex justify-between items-center tooltip-trigger relative">
                            <div class="flex items-center space-x-2">
                                <div class="w-2 h-2 bg-blade-yellow rounded-full"></div>
                                <span class="hologram-text text-blade-amber/80 text-sm">RPC PROVIDER</span>
                            </div>
                            <span class="hologram-text text-blade-yellow text-xs">HELIUS PRIMARY</span>
                            <div class="tooltip absolute bottom-full mb-2 px-3 py-2 text-xs rounded right-0">
                                RPC Provider: Helius (Primary)<br/>
                                Backup: QuickNode (Standby)<br/>
                                Rate limit: 2847/5000 req/min<br/>
                                Auto-failover: Enabled
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Configuration Settings Section -->
            <div class="mb-8">
                <h3 class="text-lg font-semibold text-white hologram-text mb-4 tracking-wider">
                    CONFIGURATION
                </h3>
                <!-- License Diagnostics -->
                <div class="bg-void-black/50 p-4 rounded border border-blade-amber/30 mb-4 hidden" id="licensePanel">
                    <h4 class="hologram-text text-blade-amber font-bold mb-3">LICENSE</h4>
                    <div class="space-y-1 text-xs hologram-text">
                        <div>MODE: <span id="licenseModeDetail">-</span></div>
                        <div>OWNER: <span id="licenseOwner">-</span></div>
                        <div>ISSUED: <span id="licenseIssued">-</span></div>
                    </div>
                </div>
                <!-- Trading Mode -->
                <div class="bg-void-black/50 p-4 rounded border border-blade-amber/30 mb-4" id="modePanel">
                    <h4 class="hologram-text text-blade-amber font-bold mb-3">TRADING MODE</h4>
                    <select id="modeSelect" class="w-full bg-void-black border border-blade-amber/30 rounded px-3 py-2 hologram-text text-white text-sm mb-3">
                        <option value="live">LIVE</option>
                        <option value="demo">DEMO</option>
                    </select>
                    <div id="demoOptions" class="space-y-3 hidden">
                        <div>
                            <label class="hologram-text text-blade-amber/80 text-sm block mb-2">INITIAL CASH</label>
                            <input type="number" id="demoCash" class="w-full bg-void-black border border-blade-amber/30 rounded px-3 py-2 hologram-text text-white text-sm" value="0" />
                        </div>
                        <div>
                            <label class="hologram-text text-blade-amber/80 text-sm block mb-2">ASSETS</label>
                            <select id="demoAssets" multiple class="w-full bg-void-black border border-blade-amber/30 rounded px-3 py-2 hologram-text text-white text-sm"></select>
                        </div>
                    </div>
                </div>
                <!-- Supported Assets -->
                <div class="bg-void-black/50 p-4 rounded border border-blade-amber/30 mb-4" id="assetPanel">
                    <h4 class="hologram-text text-blade-amber font-bold mb-3">SUPPORTED ASSETS</h4>
                    <select id="assetSelect" class="w-full bg-void-black border border-blade-amber/30 rounded px-3 py-2 hologram-text text-white text-sm"></select>
                </div>
                <!-- API Connection -->
                <div class="bg-void-black/50 p-4 rounded border border-blade-amber/30 mb-4">
                    <h4 class="hologram-text text-blade-amber font-bold mb-3">API CONNECTION</h4>
                    <div class="space-y-3">
                        <div class="tooltip-trigger relative">
                            <label class="hologram-text text-blade-amber/80 text-sm block mb-2">API BASE URL</label>
                            <input type="text" class="w-full bg-void-black border border-blade-amber/30 rounded px-3 py-2 hologram-text text-white text-sm" id="apiBaseInput" />
                        </div>
                        <div class="tooltip-trigger relative">
                            <label class="hologram-text text-blade-amber/80 text-sm block mb-2">API KEY</label>
                            <input type="text" class="w-full bg-void-black border border-blade-amber/30 rounded px-3 py-2 hologram-text text-white text-sm" id="apiKeyInput" />
                        </div>
                    </div>
                </div>

                <!-- Trading Settings -->
                <div class="bg-void-black/50 p-4 rounded border border-blade-amber/30 mb-4">
                    <h4 class="hologram-text text-blade-amber font-bold mb-3">TRADING PARAMETERS</h4>
                    <div class="space-y-4">
                        <div class="tooltip-trigger relative">
                            <label class="hologram-text text-blade-amber/80 text-sm block mb-2">MAX DRAWDOWN (%)</label>
                            <div class="flex items-center space-x-3">
                                <input type="range" min="5" max="25" value="20" class="flex-1 h-2 bg-void-black rounded-lg appearance-none cursor-pointer slider" id="maxDrawdown">
                                <span class="hologram-text text-white text-sm font-bold w-12" id="drawdownValue">20%</span>
                            </div>
                            <div class="tooltip absolute bottom-full mb-2 px-3 py-2 text-xs rounded left-0">
                                Maximum allowed portfolio drawdown<br/>
                                before emergency position reduction.<br/>
                                Current: 20% (Recommended: 15-25%)
                            </div>
                        </div>
                        
                        <div class="tooltip-trigger relative">
                            <label class="hologram-text text-blade-amber/80 text-sm block mb-2">MAX POSITION SIZE (SOL)</label>
                            <div class="flex items-center space-x-3">
                                <input type="range" min="1" max="50" value="25" class="flex-1 h-2 bg-void-black rounded-lg appearance-none cursor-pointer slider" id="maxPosition">
                                <span class="hologram-text text-white text-sm font-bold w-12" id="positionValue">25</span>
                            </div>
                            <div class="tooltip absolute bottom-full mb-2 px-3 py-2 text-xs rounded left-0">
                                Maximum SOL amount per single position.<br/>
                                Helps limit exposure to any one trade.<br/>
                                Current: 25 SOL
                            </div>
                        </div>
                        
                        <div class="tooltip-trigger relative">
                            <label class="hologram-text text-blade-amber/80 text-sm block mb-2">MAX CONCURRENT TRADES</label>
                            <div class="flex items-center space-x-3">
                                <input type="range" min="3" max="20" value="12" class="flex-1 h-2 bg-void-black rounded-lg appearance-none cursor-pointer slider" id="maxTrades">
                                <span class="hologram-text text-white text-sm font-bold w-12" id="tradesValue">12</span>
                            </div>
                            <div class="tooltip absolute bottom-full mb-2 px-3 py-2 text-xs rounded left-0">
                                Maximum number of simultaneous<br/>
                                open positions across all strategies.<br/>
                                Current: 12 trades
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Strategy Toggles -->
                <div class="bg-void-black/50 p-4 rounded border border-blade-cyan/30 mb-4">
                    <h4 class="hologram-text text-white font-bold mb-3">STRATEGY MODULES</h4>
                    <div class="space-y-3">
                        <div class="flex justify-between items-center tooltip-trigger relative">
                            <span class="hologram-text text-blade-amber/80 text-sm">LISTING SNIPER</span>
                            <label class="relative inline-flex items-center cursor-pointer">
                                <input type="checkbox" checked class="sr-only peer" id="sniperToggle">
                                <div class="w-11 h-6 bg-void-black peer-focus:outline-none rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-cyan-glow border border-blade-amber/30"></div>
                            </label>
                            <div class="tooltip absolute bottom-full mb-2 px-3 py-2 text-xs rounded right-0">
                                Enable/disable the listing sniper module.<br/>
                                Detects and trades new token listings.<br/>
                                Status: ACTIVE (7 trades today)
                            </div>
                        </div>
                        
                        <div class="flex justify-between items-center tooltip-trigger relative">
                            <span class="hologram-text text-blade-amber/80 text-sm">ARBITRAGE ENGINE</span>
                            <label class="relative inline-flex items-center cursor-pointer">
                                <input type="checkbox" checked class="sr-only peer" id="arbToggle">
                                <div class="w-11 h-6 bg-void-black peer-focus:outline-none rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-blade-amber border border-blade-amber/30"></div>
                            </label>
                            <div class="tooltip absolute bottom-full mb-2 px-3 py-2 text-xs rounded right-0">
                                Enable/disable cross-DEX arbitrage.<br/>
                                Exploits price differences between exchanges.<br/>
                                Status: ACTIVE (12 opportunities found)
                            </div>
                        </div>
                        
                        <div class="flex justify-between items-center tooltip-trigger relative">
                            <span class="hologram-text text-blade-amber/80 text-sm">MARKET MAKING</span>
                            <label class="relative inline-flex items-center cursor-pointer">
                                <input type="checkbox" class="sr-only peer" id="mmToggle">
                                <div class="w-11 h-6 bg-void-black peer-focus:outline-none rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-blade-yellow border border-blade-amber/30"></div>
                            </label>
                            <div class="tooltip absolute bottom-full mb-2 px-3 py-2 text-xs rounded right-0">
                                Enable/disable market making strategy.<br/>
                                Currently disabled due to high volatility.<br/>
                                Status: STANDBY (Waiting for stable conditions)
                            </div>
                        </div>
                        
                        <div class="flex justify-between items-center tooltip-trigger relative">
                            <span class="hologram-text text-blade-amber/80 text-sm">RISK GUARDIAN</span>
                            <label class="relative inline-flex items-center cursor-pointer">
                                <input type="checkbox" checked disabled class="sr-only peer" id="riskToggle">
                                <div class="w-11 h-6 bg-void-black peer-focus:outline-none rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-blade-yellow border border-blade-amber/30 opacity-50"></div>
                            </label>
                            <div class="tooltip absolute bottom-full mb-2 px-3 py-2 text-xs rounded right-0">
                                Risk Guardian cannot be disabled.<br/>
                                Critical safety module for portfolio protection.<br/>
                                Status: ALWAYS ACTIVE
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Network Settings -->
                <div class="bg-void-black/50 p-4 rounded border border-blade-yellow/30 mb-4">
                    <h4 class="hologram-text text-blade-yellow font-bold mb-3">NETWORK CONFIGURATION</h4>
                    <div class="space-y-3">
                        <div class="tooltip-trigger relative">
                            <label class="hologram-text text-blade-amber/80 text-sm block mb-2">PRIMARY RPC ENDPOINT</label>
                            <select class="w-full bg-void-black border border-blade-amber/30 rounded px-3 py-2 hologram-text text-white text-sm" id="rpcSelect">
                                <option value="helius">Helius (Primary) - 12ms</option>
                                <option value="quicknode">QuickNode (Backup) - 18ms</option>
                                <option value="alchemy">Alchemy - 25ms</option>
                                <option value="custom">Custom Endpoint...</option>
                            </select>
                            <div class="tooltip absolute bottom-full mb-2 px-3 py-2 text-xs rounded left-0">
                                Select primary RPC provider.<br/>
                                Auto-failover enabled for redundancy.<br/>
                                Latency shown for each option.
                            </div>
                        </div>
                        
                        <div class="flex justify-between items-center tooltip-trigger relative">
                            <span class="hologram-text text-blade-amber/80 text-sm">AUTO-FAILOVER</span>
                            <label class="relative inline-flex items-center cursor-pointer">
                                <input type="checkbox" checked class="sr-only peer" id="failoverToggle">
                                <div class="w-11 h-6 bg-void-black peer-focus:outline-none rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-blade-yellow border border-blade-amber/30"></div>
                            </label>
                            <div class="tooltip absolute bottom-full mb-2 px-3 py-2 text-xs rounded right-0">
                                Automatically switch to backup RPC<br/>
                                if primary becomes unresponsive.<br/>
                                Recommended: ENABLED
                            </div>
                        </div>
                    </div>
                </div>
                <!-- Backtest Simulation -->
                <div class="bg-void-black/50 p-4 rounded border border-blade-cyan/30 mb-4">
                    <h4 class="hologram-text text-white font-bold mb-3">BACKTEST</h4>
                    <div class="space-y-3" id="backtestForm">
                        <div>
                            <label class="hologram-text text-blade-amber/80 text-sm block mb-2">PERIOD</label>
                            <input type="text" id="btPeriod" class="w-full bg-void-black border border-blade-amber/30 rounded px-3 py-2 hologram-text text-white text-sm" placeholder="30d">
                        </div>
                        <div>
                            <label class="hologram-text text-blade-amber/80 text-sm block mb-2">CAPITAL (USD)</label>
                            <input type="number" id="btCapital" class="w-full bg-void-black border border-blade-amber/30 rounded px-3 py-2 hologram-text text-white text-sm" value="1000">
                        </div>
                        <div>
                            <label class="hologram-text text-blade-amber/80 text-sm block mb-2">STRATEGY MIX</label>
                            <input type="text" id="btStrategyMix" class="w-full bg-void-black border border-blade-amber/30 rounded px-3 py-2 hologram-text text-white text-sm" placeholder="scalper:0.5,trend:0.5">
                        </div>
                        <div id="btProgress" class="hidden w-full bg-void-black rounded-full h-2 overflow-hidden">
                            <div id="btProgressBar" class="bg-blade-cyan h-2 w-0"></div>
                        </div>
                        <div class="flex space-x-3">
                            <button class="flex-1 bg-blade-cyan/20 text-cyan-glow border border-blade-cyan/50 px-4 py-2 rounded hologram-text text-sm hover:bg-blade-cyan/30 transition-all" id="runBacktest">
                                RUN BACKTEST
                            </button>
                            <button class="flex-1 bg-blade-orange/20 text-blade-orange border border-blade-orange/50 px-4 py-2 rounded hologram-text text-sm hover:bg-blade-orange/30 transition-all hidden" id="cancelBacktest">
                                CANCEL
                            </button>
                        </div>
                    </div>
                </div>
            </div>
            <!-- Feature Schema -->
            <div class="bg-void-black/50 p-4 rounded border border-blade-cyan/30 mb-4" id="featureSchemaPanel">
                <h4 class="hologram-text text-white font-bold mb-3">AI FEATURE SCHEMA</h4>
                <div id="featureSchema" class="max-h-40 overflow-y-auto text-xs hologram-text text-white space-y-1"></div>
            </div>

            <!-- Feature Snapshot -->
            <div class="bg-void-black/50 p-4 rounded border border-blade-cyan/30 mb-4" id="featureSnapshotPanel">
                <h4 class="hologram-text text-white font-bold mb-3">CURRENT FEATURE SNAPSHOT</h4>
                <div id="featureSnapshot" class="max-h-40 overflow-y-auto text-xs hologram-text text-white space-y-1"></div>
            </div>

            <!-- AI Feature Monitor -->
            <div class="hologram-panel p-6 rounded scan-lines mt-8" id="featureStreamPanel">
                <h3 class="text-lg font-semibold text-white hologram-text tracking-wider mb-4">
                    AI FEATURE MONITOR
                </h3>
                <div id="featureStream" class="grid grid-cols-2 md:grid-cols-4 gap-2 text-xs hologram-text text-white"></div>
            </div>

            <!-- Debug Console Section -->
            <div class="mb-8">
                <div class="flex justify-between items-center mb-4">
                    <h3 class="text-lg font-semibold text-white hologram-text tracking-wider">
                        DEBUG CONSOLE
                    </h3>
                    <div class="flex space-x-2">
                        <select class="px-2 py-1 bg-blade-amber/20 text-blade-amber rounded text-xs hologram-text border border-blade-amber/50" id="logFilter">
                            <option>ALL</option>
                            <option>INFO</option>
                            <option>DEBUG</option>
                            <option>WARN</option>
                            <option>ERROR</option>
                        </select>
                        <button class="px-2 py-1 bg-void-black/50 text-blade-amber/60 rounded text-xs hologram-text border border-blade-amber/20" id="clearLogs">CLEAR</button>

                        <button class="px-2 py-1 bg-void-black/50 text-blade-amber/60 rounded text-xs hologram-text border border-blade-amber/20" id="apiExplorerBtn">API MAP</button>
                        <button class="px-2 py-1 bg-void-black/50 text-blade-amber/60 rounded text-xs hologram-text border border-blade-amber/20" id="aboutBtn">ABOUT</button>
                    </div>
                </div>

                <div class="bg-deep-black p-4 rounded border border-blade-amber/30 h-64 overflow-y-auto font-mono text-xs" id="debugConsole"></div>
            </div>
            
            <!-- Action Buttons -->
            <div class="flex space-x-3">
                <button class="flex-1 bg-blade-amber/20 text-blade-amber border border-blade-amber/50 px-4 py-2 rounded hologram-text text-sm hover:bg-blade-amber/30 transition-all" id="saveSettings">
                    SAVE SETTINGS
                </button>
                <button class="flex-1 bg-blade-orange/20 text-blade-orange border border-blade-orange/50 px-4 py-2 rounded hologram-text text-sm hover:bg-blade-orange/30 transition-all" id="resetSettings">
                    RESET TO DEFAULT
                </button>
            </div>
            <div id="saveIndicator" class="mt-2 text-blade-amber text-xs hologram-text hidden">Saving...</div>
        </div>
    </div>

    <!-- Position Details Modal -->
    <div class="position-details-modal" id="positionModal">
        <div class="modal-content">
            <div class="flex justify-between items-center mb-6">
                <h3 class="text-xl font-semibold text-white hologram-text tracking-wider" id="modalTitle">
                    POSITION DETAILS
                </h3>
                <button class="text-blade-amber hover:text-white text-2xl" id="closeModal">&times;</button>
            </div>
            <div id="modalContent">
                <!-- Dynamic content will be inserted here -->
            </div>
        </div>
    </div>

    <!-- API Explorer Modal -->
    <div class="position-details-modal" id="apiExplorerModal">
        <div class="modal-content">
            <div class="flex justify-between items-center mb-6">
                <h3 class="text-xl font-semibold text-white hologram-text tracking-wider">API MAP</h3>
                <button class="text-blade-amber hover:text-white text-2xl" id="closeApiModal">&times;</button>
            </div>
            <pre id="apiExplorerContent" class="text-xs hologram-text text-white max-h-96 overflow-y-auto whitespace-pre-wrap"></pre>
        </div>
    </div>

    <!-- About Modal -->
    <div class="position-details-modal" id="aboutModal">
        <div class="modal-content">
            <div class="flex justify-between items-center mb-6">
                <h3 class="text-xl font-semibold text-white hologram-text tracking-wider">ABOUT</h3>
                <button class="text-blade-amber hover:text-white text-2xl" id="closeAboutModal">&times;</button>
            </div>
            <div id="aboutContent" class="text-xs hologram-text text-white max-h-96 overflow-y-auto space-y-1"></div>
        </div>
    </div>

    <script>
        const pollingIntervals = [];
        let lastRpcSample = 0;
        let lastRpcStatus = 'Unknown';
        let wsHeartbeatTs = Date.now();
        let initialEquity = null;
        let lastRealizedPnL = 0;
        // System time update
        function updateTime() {
            const now = new Date();
            const timeString = now.toUTCString().split(' ')[4];
            document.getElementById('systemTime').textContent = timeString + ' UTC';
        }
        pollingIntervals.push(setInterval(updateTime, 1000));
        updateTime();

        async function pollRpcLatency() {
            if (document.hidden) return;
            try {
        const health = await apiClient.getHealth();
        if (health && typeof health.rpc_latency_ms !== 'undefined') {
            const latency = health.rpc_latency_ms;
            document.getElementById('rpcLatency').textContent = `${latency}ms`;
            console.log('RPC latency sample:', latency);
            lastRpcSample = Date.now();
            lastRpcStatus = health.status || 'Unknown';
            updateRpcTooltip();
        }
            } catch (err) {
                console.error('RPC latency poll failed', err);
            }
        }

        function updateRpcTooltip() {
            const tooltip = document.getElementById('rpcTooltip');
            if (!tooltip || !lastRpcSample) return;
            const latencyText = document.getElementById('rpcLatency').textContent || '--ms';
            const ago = ((Date.now() - lastRpcSample) / 1000).toFixed(1);
            tooltip.innerHTML = `Solana RPC Connection: ${lastRpcStatus}<br/>` +
                `Latency: ${latencyText}<br/>` +
                `Last Update: ${ago}s ago`;
        }

        function checkWsHeartbeat() {
            const el = document.getElementById('wsStatus');
            if (!el) return;
            const isLive = Date.now() - wsHeartbeatTs <= 10000;
            el.innerHTML = isLive
                ? `<span class="w-2 h-2 bg-cyan-glow rounded-full"></span><span class="text-xs hologram-text cyan-glow">LIVE</span>`
                : `<span class="w-2 h-2 bg-blade-orange rounded-full"></span><span class="text-xs hologram-text text-blade-orange">DISCONNECTED</span>`;
        }

        async function pollSystemStatus() {
            if (document.hidden) return;
            try {
                const status = await apiClient.getStatus();
                if (status) {
                    dashboardState.status = status;
                    const statusEl = document.getElementById('systemStatus');
                    const uptimeEl = document.getElementById('systemUptime');
                    if (statusEl) {
                        statusEl.textContent = status.state || 'UNKNOWN';
                        if (status.state !== 'OK') {
                            statusEl.classList.remove('cyan-glow');
                            statusEl.classList.add('text-blade-amber');
                            statusEl.setAttribute('title', status.detail || '');
                        } else {
                            statusEl.classList.remove('text-blade-amber');
                            statusEl.classList.add('cyan-glow');
                            statusEl.removeAttribute('title');
                        }
                    }
                    if (uptimeEl && typeof status.uptime_pct !== 'undefined') {
                        uptimeEl.textContent = `${status.uptime_pct.toFixed(2)}%`;
                    }

                    updateModuleStatus('moduleDataFeed', 'moduleDataFeedDot', status.data_feed);
                    updateModuleStatus('moduleInferenceEngine', 'moduleInferenceEngineDot', status.inference_engine);
                    updateModuleStatus('moduleRiskManager', 'moduleRiskManagerDot', status.risk_manager);
                    updateModuleStatus('moduleTradeExecution', 'moduleTradeExecutionDot', status.trade_execution);
                }
            } catch (err) {
                console.error('System status poll failed', err);
            }
        }

        function updateModuleStatus(textId, dotId, state) {
            const text = document.getElementById(textId);
            const dot = document.getElementById(dotId);
            if (!text || !dot) return;
            const ok = state === 'OK';
            text.textContent = state || 'UNKNOWN';
            dot.className = `w-2 h-2 rounded-full ${ok ? 'bg-cyan-glow' : 'bg-blade-orange'}`;
        }

        async function pollMetrics() {
            if (document.hidden) return;
            try {
                const m = await apiClient.get('/metrics');
                if (m) {
                    dashboardState.metrics = m;
                    updateSystemHealth();
                }
            } catch (err) {
                console.error('Metrics poll failed', err);
            }
        }

        // Trading toggle functionality
        let tradingActive = false;
        let lastTradingChange = null;
        const tradingToggle = document.getElementById('tradingToggle');
        const tradingTooltip = document.getElementById('tradingTooltip');

        function updateTradingButton() {
            tradingToggle.textContent = tradingActive ? '⏸ PAUSE' : '▶ START';
            tradingToggle.className = tradingActive ?
                'control-button px-4 py-2 rounded text-xs hologram-text tooltip-trigger relative bg-cyan-glow/20 border-cyan-glow/50 text-cyan-glow' :
                'control-button px-4 py-2 rounded text-xs hologram-text tooltip-trigger relative';
            if (tradingTooltip) {
                if (lastTradingChange) {
                    const time = new Date(lastTradingChange).toLocaleTimeString();
                    tradingTooltip.textContent = `Last changed: ${time}`;
                } else {
                    tradingTooltip.textContent = 'Start/Pause Trading Engine';
                }
            }
        }
        updateTradingButton();

        tradingToggle.addEventListener('click', async function() {
            const next = !tradingActive;
            try {
                const res = await apiClient.setState({ running: next });
                if (!res) {
                    showToast('Failed to update trading state');
                    return;
                }
                const verify = await apiClient.getState();
                if (!verify || verify.running !== next) {
                    showToast('Trading state verification failed');
                    return;
                }
                tradingActive = next;
                lastTradingChange = Date.now();
                updateTradingButton();
            } catch (err) {
                console.error('trading toggle failed', err);
                showToast('Trading toggle failed');
            }
        });

        // Tab functionality for positions/history
        const tabButtons = document.querySelectorAll('.tab-button');
        const tabContents = document.querySelectorAll('.tab-content');
        
        tabButtons.forEach(button => {
            button.addEventListener('click', function() {
                const targetTab = this.getAttribute('data-tab');
                
                // Update button states
                tabButtons.forEach(btn => {
                    btn.classList.remove('active');
                });
                this.classList.add('active');
                
                // Show/hide content
                tabContents.forEach(content => {
                    content.classList.add('hidden');
                });
                document.getElementById(targetTab + 'Tab').classList.remove('hidden');
                if (targetTab === 'history') {
                    loadHistory();
                }
            });
        });

        // Chart tab functionality
        const chartTabs = document.querySelectorAll('.chart-tab');
        const chartPanels = document.querySelectorAll('.chart-panel');

        chartTabs.forEach(tab => {
            tab.addEventListener('click', function() {
                const target = this.getAttribute('data-chart') + 'Chart';

                // Update button states
                chartTabs.forEach(t => t.classList.remove('active'));
                this.classList.add('active');

                // Show/hide panels
                chartPanels.forEach(panel => panel.classList.add('hidden'));
                const activePanel = document.getElementById(target);
                if (activePanel) activePanel.classList.remove('hidden');
            });
        });

        const marketButtons = document.querySelectorAll('.market-symbol');
        const openTradingView = document.getElementById('openTradingView');
        marketButtons.forEach(btn => {
            btn.addEventListener('click', () => {
                marketButtons.forEach(b => {
                    b.classList.remove('active', 'bg-blade-amber/20', 'text-blade-amber');
                    b.classList.add('bg-void-black/50', 'text-blade-amber/60');
                });
                btn.classList.add('active', 'bg-blade-amber/20', 'text-blade-amber');
                btn.classList.remove('bg-void-black/50', 'text-blade-amber/60');
            });
        });
        openTradingView?.addEventListener('click', () => {
            const active = document.querySelector('.market-symbol.active') || document.querySelector('.market-symbol');
            if (!active) return;
            const [base] = active.textContent.trim().split('/');
            window.open(`${apiClient.baseURL}/tv?symbol=${base}`, '_blank');
        });

        let selectedPosition = null;
        const positionRows = new Map();

        const positionModal = document.getElementById('positionModal');
        document.getElementById('closeModal').addEventListener('click', () => {
            positionModal.classList.remove('show');
            if (selectedPosition) {
                selectedPosition.classList.remove('selected');
                selectedPosition = null;
            }
        });
        positionModal.addEventListener('click', e => {
            if (e.target === positionModal) {
                positionModal.classList.remove('show');
                if (selectedPosition) {
                    selectedPosition.classList.remove('selected');
                    selectedPosition = null;
                }
            }
        });

        // Settings panel functionality
        const settingsToggle = document.getElementById('settingsToggle');
        const settingsPanel = document.getElementById('settingsPanel');
        const closeSettings = document.getElementById('closeSettings');

        settingsToggle.addEventListener('click', async function() {
            settingsPanel.classList.add('settings-panel-open');
            try {
                const s = await apiClient.getState();
                if (s) {
                    dashboardState.state = s;
                    if (s.settings) applySettings(s.settings);
                    if (!dashboardState.assets) {
                        dashboardState.assets = await apiClient.getAssets().catch(() => null);
                        if (dashboardState.assets) populateAssetSelect(dashboardState.assets);
                    }
                    updateModePanel();
                }
            } catch (err) {
                console.error('failed to load state', err);
            }
        });
        
        closeSettings.addEventListener('click', function() {
            settingsPanel.classList.remove('settings-panel-open');
        });
        
        // Close settings panel when clicking outside
        document.addEventListener('click', function(event) {
            if (!settingsPanel.contains(event.target) && !settingsToggle.contains(event.target)) {
                settingsPanel.classList.remove('settings-panel-open');
            }
        });

        // Slider functionality and auto-saving of settings
        let settingsTimer;
        let isSavingSettings = false;
        const settingControls = ['maxDrawdown', 'maxPosition', 'maxTrades', 'sniperToggle', 'arbToggle', 'mmToggle', 'failoverToggle', 'rpcSelect', 'modeSelect', 'demoCash', 'demoAssets', 'saveSettings', 'resetSettings'];

        function setSettingsDisabled(disabled) {
            settingControls.forEach(id => {
                const el = document.getElementById(id);
                if (el) el.disabled = disabled;
            });
        }

        function showToast(message) {
            const container = document.getElementById('toastContainer');
            if (!container) return;
            const toast = document.createElement('div');
            toast.className = 'bg-blade-orange/90 text-white px-4 py-2 rounded shadow-lg';
            toast.textContent = message;
            container.appendChild(toast);
            setTimeout(() => toast.remove(), 3000);
        }

        function collectSettings() {
            return {
                max_drawdown: parseFloat(document.getElementById('maxDrawdown').value) / 100,
                max_position_size: parseFloat(document.getElementById('maxPosition').value),
                max_concurrent_trades: parseInt(document.getElementById('maxTrades').value),
                strategies: {
                    listing_sniper: document.getElementById('sniperToggle').checked,
                    arbitrage: document.getElementById('arbToggle').checked,
                    market_making: document.getElementById('mmToggle').checked
                },
                rpc_provider: document.getElementById('rpcSelect').value,
                auto_failover: document.getElementById('failoverToggle').checked
            };
        }

        function queueSettingsSave() {
            clearTimeout(settingsTimer);
            settingsTimer = setTimeout(async () => {
                if (isSavingSettings) return;
                isSavingSettings = true;
                setSettingsDisabled(true);
                const indicator = document.getElementById('saveIndicator');
                if (indicator) indicator.classList.remove('hidden');
                try {
                    await apiClient.post('/state', { settings: collectSettings() });
                } catch (err) {
                    console.error('auto save settings failed', err);
                    showToast('Failed to save settings');
                } finally {
                    if (indicator) indicator.classList.add('hidden');
                    setSettingsDisabled(false);
                    isSavingSettings = false;
                }
            }, 500);
        }

        const sliders = [
            { slider: 'maxDrawdown', display: 'drawdownValue', suffix: '%' },
            { slider: 'maxPosition', display: 'positionValue', suffix: '' },
            { slider: 'maxTrades', display: 'tradesValue', suffix: '' }
        ];

        sliders.forEach(({ slider, display, suffix }) => {
            const sliderElement = document.getElementById(slider);
            const displayElement = document.getElementById(display);

            sliderElement.addEventListener('input', function() {
                displayElement.textContent = this.value + suffix;
                queueSettingsSave();
            });
        });

        ['sniperToggle', 'arbToggle', 'mmToggle', 'failoverToggle'].forEach(id => {
            const el = document.getElementById(id);
            if (el) el.addEventListener('change', queueSettingsSave);
        });
        const rpcSelect = document.getElementById('rpcSelect');
        if (rpcSelect) rpcSelect.addEventListener('change', queueSettingsSave);

        const modeSelect = document.getElementById('modeSelect');
        const demoCashInput = document.getElementById('demoCash');
        const demoAssetsSelect = document.getElementById('demoAssets');
        const demoOptions = document.getElementById('demoOptions');
        async function saveMode() {
            const mode = modeSelect.value;
            demoOptions.classList.toggle('hidden', mode !== 'demo');
            const payload = { mode };
            if (mode === 'demo') {
                const cash = parseFloat(demoCashInput.value) || 0;
                const assets = Array.from(demoAssetsSelect.selectedOptions).map(o => o.value);
                payload.paper_capital = cash;
                payload.paper_assets = assets;
            }
            try {
                const res = await apiClient.setState(payload);
                dashboardState.state = res;
                dashboardState.isDemo = res.mode === 'demo';
                updateLicenseMode(dashboardState.isDemo);
                updateModePanel();
            } catch (err) {
                console.error('mode change failed', err);
                showToast('Mode change failed');
            }
        }
        if (modeSelect) modeSelect.addEventListener('change', saveMode);
        [demoCashInput, demoAssetsSelect].forEach(el => {
            el && el.addEventListener('change', () => {
                if (modeSelect.value === 'demo') saveMode();
            });
        });

        // Debug console functionality
        const debugConsole = document.getElementById('debugConsole');
        const logFilter = document.getElementById('logFilter');
        const clearLogs = document.getElementById('clearLogs');
        const apiExplorerBtn = document.getElementById('apiExplorerBtn');
        const apiExplorerModal = document.getElementById('apiExplorerModal');
        const apiExplorerContent = document.getElementById('apiExplorerContent');
        const closeApiModal = document.getElementById('closeApiModal');
        const aboutBtn = document.getElementById('aboutBtn');
        const aboutModal = document.getElementById('aboutModal');
        const aboutContent = document.getElementById('aboutContent');
        const closeAboutModal = document.getElementById('closeAboutModal');
        const logBuffer = [];
        const MAX_LOGS = 500;

        function levelClass(level) {
            switch (level) {
                case 'DEBUG': return 'text-blade-amber';
                case 'WARN': return 'text-blade-orange';
                case 'ERROR': return 'text-red-500';
                case 'INFO': return 'text-white';
                default: return 'text-white';
            }
        }

        function renderLogs() {
            debugConsole.innerHTML = '';
            const level = logFilter.value;
            for (const log of logBuffer) {
                if (level !== 'ALL' && log.level !== level) continue;
                const div = document.createElement('div');
                div.className = levelClass(log.level);
                div.textContent = `[${new Date(log.timestamp).toLocaleTimeString()}] ${log.level}: ${log.message}`;
                debugConsole.appendChild(div);
            }
            debugConsole.scrollTop = debugConsole.scrollHeight;
        }

        function appendLog(entry) {
            logBuffer.push(entry);
            if (logBuffer.length > MAX_LOGS) logBuffer.shift();
            renderLogs();
        }

        logFilter.addEventListener('change', renderLogs);
        clearLogs.addEventListener('click', () => {
            logBuffer.length = 0;
            renderLogs();
        });

        apiExplorerBtn?.addEventListener('click', async () => {
            try {
                const map = await apiClient.getServiceMap();
                apiExplorerContent.textContent = JSON.stringify(map, null, 2);
            } catch (err) {
                apiExplorerContent.textContent = 'Failed to load service map';
            }
            apiExplorerModal.classList.add('show');
        });
        closeApiModal?.addEventListener('click', () => apiExplorerModal.classList.remove('show'));
        apiExplorerModal?.addEventListener('click', e => {
            if (e.target === apiExplorerModal) apiExplorerModal.classList.remove('show');
        });

        aboutBtn?.addEventListener('click', async () => {
            aboutContent.textContent = 'Loading...';
            try {
                const [version, manifest] = await Promise.all([
                    apiClient.getVersion(),
                    apiClient.getManifest()
                ]);
                aboutContent.innerHTML =
                    `<div>Commit: ${version.git}</div>` +
                    `<div>Schema: ${version.schema}</div>` +
                    `<div>REST endpoints: ${manifest.rest.length}</div>` +
                    `<div>WebSockets: ${manifest.websocket.length}</div>`;
            } catch (err) {
                aboutContent.textContent = 'Failed to load build metadata';
            }
            aboutModal.classList.add('show');
        });
        closeAboutModal?.addEventListener('click', () => aboutModal.classList.remove('show'));
        aboutModal?.addEventListener('click', e => {
            if (e.target === aboutModal) aboutModal.classList.remove('show');
        });
        
        // Trading feed integration with API
        let feedPaused = false;
        
        // Add entry to trading feed
        function addFeedEntry(entry) {
            const feedContainer = document.getElementById('tradingFeed');
            const timestamp = entry.timestamp.toLocaleTimeString();

            // Remove placeholder if present
            const placeholder = document.getElementById('feedPlaceholder');
            if (placeholder) {
                placeholder.remove();
            }

            const feedElement = document.createElement('div');
            feedElement.className = `bg-void-black/50 p-3 rounded border-l-2 border-${entry.color}`;

            feedElement.innerHTML = `
                <div class="flex justify-between items-center">
                    <div>
                        <span class="hologram-text text-${entry.color} text-xs">${timestamp}</span>
                        <span class="hologram-text text-${entry.color === 'blade-cyan' ? 'cyan-glow' : 'blade-amber'} ml-3 font-bold">${entry.type}</span>
                        <span class="hologram-text text-white ml-2">${entry.message}</span>
                    </div>
                    ${entry.confidence ? `<span class="hologram-text text-${entry.color}/60 text-xs">${entry.confidence}</span>` : ''}
                </div>
            `;
            
            // Add to top of feed
            feedContainer.insertBefore(feedElement, feedContainer.firstChild);
            
            // Keep only last 20 entries
            while (feedContainer.children.length > 20) {
                feedContainer.removeChild(feedContainer.lastChild);
            }
        }
        // Render a single closed trade entry
        function renderHistoryEntry(order) {
            const pnl = order.pnl ?? 0;
            const entry = document.createElement('div');
            entry.className = 'bg-void-black/50 p-4 rounded border';
            entry.classList.add(pnl >= 0 ? 'border-blade-cyan/30' : 'border-blade-orange/30');
            const color = pnl >= 0 ? 'text-cyan-glow' : 'text-blade-orange';
            const time = order.timestamp ? new Date(order.timestamp * 1000).toLocaleTimeString() : '';
            entry.innerHTML = `
                <div class="flex items-center justify-between mb-2">
                    <div>
                        <div class="hologram-text text-white font-bold">${order.symbol || order.token || ''} CLOSED</div>
                        <div class="hologram-text text-xs text-blade-amber/60">${time} • ${order.strategy || ''}</div>
                    </div>
                    <div class="text-right">
                        <div class="hologram-text ${color} font-bold">${pnl >= 0 ? '+' : ''}${pnl} SOL</div>
                    </div>
                </div>`;
            return entry;
        }

        function appendHistoryEntry(order) {
            const list = document.getElementById('historyList');
            if (!list) return;
            const entry = renderHistoryEntry(order);
            list.insertBefore(entry, list.firstChild);
        }

        async function loadHistory() {
            try {
                const orders = await apiClient.get('/orders?status=closed');
                const list = document.getElementById('historyList');
                if (!orders || !Array.isArray(orders) || !list) return;
                list.innerHTML = '';
                orders.filter(o => !o.status || o.status === 'closed').forEach(o => appendHistoryEntry(o));
            } catch (err) {
                console.error('Error loading history:', err);
            }
        }
        
        // Feed pause/resume functionality
        document.getElementById('pauseFeed').addEventListener('click', function() {
            feedPaused = !feedPaused;
            this.textContent = feedPaused ? 'RESUME' : 'PAUSE';
            this.className = feedPaused ? 
                'text-xs hologram-text text-cyan-glow hover:text-white border border-cyan-glow/50 px-3 py-1 rounded' :
                'text-xs hologram-text text-blade-amber/60 hover:text-blade-amber border border-blade-amber/30 px-3 py-1 rounded';
        });
        
        
        // Reset settings functionality
        document.getElementById('resetSettings').addEventListener('click', function() {
            if (confirm('Reset all settings to default values? This action cannot be undone.')) {
                // Reset sliders
                document.getElementById('maxDrawdown').value = 20;
                document.getElementById('drawdownValue').textContent = '20%';
                document.getElementById('maxPosition').value = 25;
                document.getElementById('positionValue').textContent = '25';
                document.getElementById('maxTrades').value = 12;
                document.getElementById('tradesValue').textContent = '12';
                
                // Reset toggles
                document.getElementById('sniperToggle').checked = true;
                document.getElementById('arbToggle').checked = true;
                document.getElementById('mmToggle').checked = false;
                document.getElementById('failoverToggle').checked = true;
                
                // Reset RPC selection
                document.getElementById('rpcSelect').value = 'helius';
                
                this.textContent = 'RESET COMPLETE ✓';
                setTimeout(() => {
                    this.textContent = 'RESET TO DEFAULT';
                }, 2000);
            }
        });
        
        function applySettings(settings) {
            if (!settings) return;
            if (typeof settings.max_drawdown === 'number') {
                const md = Math.round(settings.max_drawdown * 100);
                document.getElementById('maxDrawdown').value = md;
                document.getElementById('drawdownValue').textContent = md + '%';
            }
            if (typeof settings.max_position_size === 'number') {
                const mp = settings.max_position_size;
                document.getElementById('maxPosition').value = mp;
                document.getElementById('positionValue').textContent = mp;
            }
            if (typeof settings.max_concurrent_trades === 'number') {
                const mt = settings.max_concurrent_trades;
                document.getElementById('maxTrades').value = mt;
                document.getElementById('tradesValue').textContent = mt;
            }
            if (settings.strategies) {
                document.getElementById('sniperToggle').checked = !!settings.strategies.listing_sniper;
                document.getElementById('arbToggle').checked = !!settings.strategies.arbitrage;
                document.getElementById('mmToggle').checked = !!settings.strategies.market_making;
            }
            if (settings.rpc_provider) {
                document.getElementById('rpcSelect').value = settings.rpc_provider;
            }
            if (typeof settings.auto_failover === 'boolean') {
                document.getElementById('failoverToggle').checked = settings.auto_failover;
            }
        }

        // Settings panel API integration
        document.getElementById('saveSettings').addEventListener('click', async function() {
            this.textContent = 'SAVING...';
            this.disabled = true;

            try {
                const settings = collectSettings();
                const response = await apiClient.post('/state', { settings });

                if (response) {
                    if (response.settings) {
                        applySettings(response.settings);
                    }
                    this.textContent = 'SAVED ✓';
                    setTimeout(() => {
                        this.textContent = 'SAVE SETTINGS';
                        this.disabled = false;
                    }, 1000);
                } else {
                    throw new Error('Failed to save settings');
                }
            } catch (error) {
                console.error('Error saving settings:', error);
                this.textContent = 'ERROR - RETRY';
                this.disabled = false;
            }
        });
        let backtestEndpoint = null;

        async function runBacktest() {
            const period = document.getElementById('btPeriod').value.trim();
            const capital = parseFloat(document.getElementById('btCapital').value);
            const strategy_mix = document.getElementById('btStrategyMix').value.trim();

            if (!period) {
                showToast('Backtest period is required');
                return;
            }
            if (!Number.isFinite(capital) || capital <= 0) {
                showToast('Starting capital must be a positive number');
                return;
            }
            if (!strategy_mix) {
                showToast('Strategy mix is required');
                return;
            }

            const params = { period, capital, strategy_mix };
            localStorage.setItem('backtest_params', JSON.stringify(params));

            const btn = document.getElementById('runBacktest');
            const cancelBtn = document.getElementById('cancelBacktest');
            const progress = document.getElementById('btProgress');
            const bar = document.getElementById('btProgressBar');

            btn.disabled = true;
            btn.textContent = 'RUNNING...';
            cancelBtn.classList.remove('hidden');
            progress.classList.remove('hidden');

            try {
                const res = await apiClient.runBacktest(params);
                if (!res || !res.id) throw new Error('start failed');
                backtestEndpoint = `/backtest/ws/${res.id}`;
                wsClient.connect(backtestEndpoint, (msg) => {
                    if (msg.progress !== undefined) {
                        bar.style.width = `${msg.progress}%`;
                    }
                    if (msg.pnl !== undefined) {
                        document.getElementById('backtestPnL').textContent = `$${msg.pnl.toFixed(2)}`;
                        document.getElementById('backtestStats').textContent = `DD ${(msg.drawdown * 100).toFixed(2)}% • SHARPE ${msg.sharpe.toFixed(2)}`;
                        wsClient.disconnect(backtestEndpoint);
                        backtestEndpoint = null;
                        btn.disabled = false;
                        btn.textContent = 'RUN BACKTEST';
                        cancelBtn.classList.add('hidden');
                        progress.classList.add('hidden');
                        bar.style.width = '0';
                    }
                });
            } catch (err) {
                console.error('Backtest failed:', err);
                showToast('Backtest failed');
                btn.disabled = false;
                btn.textContent = 'RUN BACKTEST';
                cancelBtn.classList.add('hidden');
                progress.classList.add('hidden');
                bar.style.width = '0';
            }
        }

        document.getElementById('runBacktest').addEventListener('click', runBacktest);
        document.getElementById('cancelBacktest').addEventListener('click', () => {
            if (backtestEndpoint) {
                wsClient.disconnect(backtestEndpoint);
                backtestEndpoint = null;
            }
            const btn = document.getElementById('runBacktest');
            const progress = document.getElementById('btProgress');
            const bar = document.getElementById('btProgressBar');
            btn.disabled = false;
            btn.textContent = 'RUN BACKTEST';
            progress.classList.add('hidden');
            bar.style.width = '0';
            document.getElementById('cancelBacktest').classList.add('hidden');
        });

        // Emergency stop functionality
        document.querySelector('.emergency-stop').addEventListener('click', async function() {
            if (!confirm('EMERGENCY STOP: This will immediately close all positions and halt trading. Continue?')) return;

            const btn = this;
            try {
                btn.classList.add('bg-blade-amber/50');
                const res = await apiClient.setState({
                    running: false,
                    emergency_stop: true
                });
                if (!res) {
                    showToast('Emergency stop failed');
                    btn.classList.remove('bg-blade-amber/50');
                    return;
                }
                const verify = await apiClient.getState();
                const pos = await apiClient.getPositions();
                if (!verify || verify.running || (pos && Object.keys(pos).length !== 0)) {
                    showToast('Emergency stop verification failed');
                    btn.classList.remove('bg-blade-amber/50');
                    return;
                }

                tradingActive = false;
                lastTradingChange = Date.now();
                updateTradingButton();

                const original = btn.textContent;
                btn.textContent = '✓ STOPPED';
                setTimeout(() => {
                    btn.textContent = original;
                    btn.classList.remove('bg-blade-amber/50');
                }, 3000);
            } catch (error) {
                console.error('Error executing emergency stop:', error);
                showToast('Emergency stop failed');
                btn.classList.remove('bg-blade-amber/50');
            }
        });
        
        // Order placement functionality (for future use)
        async function placeOrder({ token, qty, side, limit }) {
            try {
                const response = await apiClient.placeOrder({ token, qty, side, limit });
                if (response) {
                    console.log('Order placed successfully:', response);
                    // Update UI with new order
                    addFeedEntry({
                        timestamp: new Date(response.timestamp ? response.timestamp * 1000 : Date.now()),
                        type: response.side.toUpperCase(),
                        message: `${response.quantity} ${response.token} @ $${response.price}`,
                        strategy: 'MANUAL',
                        confidence: null,
                        color: response.side === 'buy' ? 'blade-cyan' : 'blade-amber'
                    });
                }
                return response;
            } catch (error) {
                console.error('Error placing order:', error);
                return null;
            }
        }
        
        // Complete Sol-Seeker API Client
        class SolSeekerAPI {
            constructor() {
                this.baseURL = window.API_BASE || localStorage.getItem('sol_seeker_api_base') || window.location.origin;
                this.apiKey = window.API_KEY || localStorage.getItem('sol_seeker_api_key') || '';
                this.isConnected = false;
                this.retryCount = 0;
                this.maxRetries = 3;
                this.checkHealth();
            }

            async checkHealth() {
                try {
                    const res = await fetch(`${this.baseURL}/health`);
                    if (!res.ok) throw new Error('health check failed');
                } catch {
                    const input = window.prompt('Enter API base URL', this.baseURL);
                    if (input) {
                        this.setApiBase(input);
                    }
                }
            }

            // Generic request method with error handling
            async request(endpoint, options = {}) {
                const url = `${this.baseURL}${endpoint}`;
                const headers = {
                    'Content-Type': 'application/json',
                    ...(this.apiKey && { 'X-API-Key': this.apiKey }),
                    ...options.headers
                };

                try {
                    const response = await fetch(url, {
                        ...options,
                        headers
                    });

                    if (response.status === 401) {
                        this.promptForApiKey();
                        return null;
                    }

                    if (!response.ok) {
                        throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                    }

                    const data = await response.json();
                    this.isConnected = true;
                    this.retryCount = 0;
                    return data;

                } catch (error) {
                    console.error(`API request failed for ${endpoint}:`, error);
                    this.isConnected = false;

                    // Retry logic for critical endpoints
                    if (this.retryCount < this.maxRetries && this.isCriticalEndpoint(endpoint)) {
                        this.retryCount++;
                        console.log(`Retrying ${endpoint} (${this.retryCount}/${this.maxRetries})`);
                        await new Promise(resolve => setTimeout(resolve, 1000 * this.retryCount));
                        return this.request(endpoint, options);
                    }

                    return null;
                }
            }

            // Check if endpoint is critical for dashboard operation
            isCriticalEndpoint(endpoint) {
                const critical = ['/health', '/status', '/dashboard', '/positions'];
                return critical.some(path => endpoint.includes(path));
            }
            
            // GET request helper
            async get(endpoint) {
                return this.request(endpoint, { method: 'GET' });
            }
            
            // POST request helper
            async post(endpoint, data) {
                return this.request(endpoint, {
                    method: 'POST',
                    body: JSON.stringify(data)
                });
            }
            
            // Core API endpoints
            async getHealth() {
                return this.get('/health');
            }
            
            async getStatus() {
                return this.get('/status');
            }
            
            async getState() {
                return this.get('/state');
            }
            
            async setState(stateData) {
                return this.post('/state', stateData);
            }
            
            async getDashboard() {
                return this.get('/dashboard');
            }
            
            async getPositions() {
                return this.get('/positions');
            }
            
            async getOrders() {
                return this.get('/orders');
            }
            
            async placeOrder(orderData) {
                return this.post('/orders', orderData);
            }

            async runBacktest(config) {
                return this.post('/backtest', config);
            }
            
            async getAssets() {
                return this.get('/assets');
            }
            
            async getFeatures() {
                return this.get('/features');
            }
            
            async getFeaturesSchema() {
                return this.get('/features/schema');
            }
            
            async getPosterior() {
                return this.get('/posterior');
            }

            async getChart(symbol) {
                return this.get(`/chart/${symbol}`);
            }

            async getRiskSecurity() {
                return this.get('/risk/security');
            }

            async getCatalysts() {
                return this.get('/catalysts');
            }

            async getMetrics() {
                return this.get('/metrics');
            }
            
            async getVersion() {
                return this.get('/version');
            }
            
            async getManifest() {
                return this.get('/manifest');
            }

            async getServiceMap() {
                return this.get('/api');
            }
            
            async getLicense() {
                return this.get('/license');
            }
            
            async getTradingView() {
                return this.get('/tv');
            }
            
            // WebSocket endpoints
            getWebSocketURL(endpoint) {
                const url = new URL(this.baseURL);
                const wsProtocol = url.protocol === 'https:' ? 'wss:' : 'ws:';
                return `${wsProtocol}//${url.host}${endpoint}?key=${encodeURIComponent(this.apiKey || '')}`;
            }

            // API configuration
            setApiBase(url) {
                this.baseURL = url;
                localStorage.setItem('sol_seeker_api_base', url);
            }

            // API key management
            setApiKey(key) {
                this.apiKey = key;
                localStorage.setItem('sol_seeker_api_key', key);
            }

            clearApiKey() {
                this.apiKey = '';
                localStorage.removeItem('sol_seeker_api_key');
            }

            promptForApiKey() {
                const key = window.prompt('API key required. Please enter your API key:');
                if (key) {
                    this.setApiKey(key);
                    window.dispatchEvent(new CustomEvent('apiKey', { detail: key }));
                }
            }

            ensureApiKey() {
                if (this.apiKey) {
                    return Promise.resolve(this.apiKey);
                }
                return new Promise((resolve) => {
                    const handler = (e) => {
                        window.removeEventListener('apiKey', handler);
                        resolve(e.detail);
                    };
                    window.addEventListener('apiKey', handler);
                    this.promptForApiKey();
                });
            }
        }

        // Initialize API client
        const apiClient = new SolSeekerAPI();
        window.SolSeekerAPI = apiClient;

        // Initialize API connection inputs
        const apiBaseInput = document.getElementById('apiBaseInput');
        const apiKeyInput = document.getElementById('apiKeyInput');
        if (apiBaseInput) {
            apiBaseInput.value = apiClient.baseURL;
            apiBaseInput.addEventListener('change', (e) => {
                try {
                    const url = new URL(e.target.value.trim());
                    apiClient.setApiBase(url.toString());
                } catch {
                    showToast('Invalid API base URL');
                    apiBaseInput.value = apiClient.baseURL;
                }
            });
        }
        if (apiKeyInput) {
            apiKeyInput.value = apiClient.apiKey;
            apiKeyInput.addEventListener('change', (e) => {
                const key = e.target.value.trim();
                if (!key) {
                    showToast('API key cannot be empty');
                    apiKeyInput.value = apiClient.apiKey;
                    return;
                }
                apiClient.setApiKey(key);
            });
        }

        // Restore saved backtest parameters
        const storedBt = localStorage.getItem('backtest_params');
        if (storedBt) {
            try {
                const params = JSON.parse(storedBt);
                if (params.period) document.getElementById('btPeriod').value = params.period;
                if (params.capital !== undefined) document.getElementById('btCapital').value = params.capital;
                if (params.strategy_mix) document.getElementById('btStrategyMix').value = params.strategy_mix;
            } catch (err) {
                console.warn('Invalid stored backtest params', err);
            }
        }
        
        // Dashboard state management
        const dashboardState = {
            health: null,
            status: null,
            dashboard: null,
            positions: null,
            orders: null,
            features: null,
            posterior: null,
            assets: null,
            featureSchema: null,
            metrics: null,
            license: null,
            lastUpdate: null,
            isDemo: false
        };

        let strategyPeriod = '7d';
        
        // Update dashboard data from API
        async function updateDashboardData() {
            if (document.hidden) return; // Don't update when tab is hidden
            
            try {
                // Fetch core dashboard data
                const [dashboard, positions, orders, featureSnap, posterior, state, security, license, catalysts] = await Promise.all([
                    apiClient.getDashboard(),
                    apiClient.getPositions(),
                    apiClient.getOrders(),
                    apiClient.getFeatures(),
                    apiClient.getPosterior(),
                    apiClient.getState(),
                    apiClient.getRiskSecurity().catch(() => null),
                    apiClient.getLicense().catch(() => null),
                    apiClient.getCatalysts().catch(() => null)
                ]);

                // Update state
                dashboardState.dashboard = dashboard;
                dashboardState.positions = positions;
                dashboardState.orders = orders;
                dashboardState.features = featureSnap?.features;
                const featureTs = featureSnap?.timestamp;
                if (Array.isArray(dashboardState.features)) {
                    updateFeatureStream(dashboardState.features);
                    renderFeatureSnapshot(dashboardState.features, featureTs);
                }
                dashboardState.posterior = posterior;
                dashboardState.lastUpdate = new Date();
                dashboardState.state = state;
                dashboardState.security = security;
                dashboardState.license = license;
                dashboardState.catalysts = catalysts;
                if (state && state.settings) {
                    applySettings(state.settings);
                }
                const mode = state?.mode || license?.mode;
                dashboardState.isDemo = mode === 'demo';
                updateLicenseMode(dashboardState.isDemo);
                tradingActive = !!state?.running;
                updateTradingButton();

                if (!dashboardState.assets) {
                    dashboardState.assets = await apiClient.getAssets().catch(() => null);
                    if (dashboardState.assets) populateAssetSelect(dashboardState.assets);
                }
                updateModePanel();
                if (!dashboardState.featureSchema) {
                    dashboardState.featureSchema = await apiClient.getFeaturesSchema().catch(() => null);
                    if (dashboardState.featureSchema) renderFeatureSchema(dashboardState.featureSchema);
                }

                // Update UI components
                updatePortfolioMetrics();
                updateRiskMetrics();
                updateSecurityPanel();
                await updatePositionsDisplay(positions);
                updateSystemHealth();
                updateRegimeAnalysis();
                updateMarketStats();
                updateLicensePanel();
                updateCatalystList(catalysts);
                updateLicenseMode(dashboardState.isDemo);
                
            } catch (error) {
                console.error('Error updating dashboard data:', error);
                dashboardState.isDemo = true;
                updateLicenseMode(true);
            }
        }
        
        // Update portfolio metrics from API data
        function updatePortfolioMetrics() {
            if (!dashboardState.dashboard || !dashboardState.dashboard.risk) return;

            const risk = dashboardState.dashboard.risk;
            const equity = risk.equity || 0;
            if (initialEquity === null) initialEquity = equity;
            document.getElementById('portfolioValue').textContent =
                `$${equity.toLocaleString('en-US', { minimumFractionDigits: 2, maximumFractionDigits: 2 })}`;

            const change = equity - initialEquity;
            const changePercent = initialEquity ? (change / initialEquity) * 100 : 0;
            const changeElement = document.getElementById('portfolioChange');
            changeElement.textContent =
                `${change >= 0 ? '+' : '-'}$${Math.abs(change).toFixed(2)} (${change >= 0 ? '+' : '-'}${Math.abs(changePercent).toFixed(2)}%)`;
            changeElement.className = `text-sm hologram-text ${change >= 0 ? 'text-cyan-glow' : 'text-blade-orange'} mt-1`;

            const realized = risk.realized || 0;
            const pnlElement = document.getElementById('realizedPnL');
            pnlElement.textContent = `${realized >= 0 ? '+' : '-'}$${Math.abs(realized).toLocaleString('en-US', { minimumFractionDigits: 2 })}`;
            pnlElement.className = `text-3xl font-bold ${realized >= 0 ? 'cyan-glow' : 'text-blade-orange'} data-flicker`;

            const delta = realized - lastRealizedPnL;
            lastRealizedPnL = realized;
            const pnlChangeEl = document.getElementById('realizedPnLChange');
            if (pnlChangeEl) {
                pnlChangeEl.textContent = `${delta >= 0 ? '↗ +' : '↘ -'}$${Math.abs(delta).toFixed(2)} TODAY`;
            }

            updateEquityLabels();
        }

        function updateRiskMetrics() {
            const risk = dashboardState.dashboard && dashboardState.dashboard.risk;
            if (!risk) return;
            const ddEl = document.getElementById('riskMaxDrawdown');
            if (ddEl) {
                ddEl.textContent = `${(risk.drawdown * 100).toFixed(2)}%`;
            }
            const psEl = document.getElementById('positionSize');
            if (psEl && risk.position_size !== undefined) {
                psEl.textContent = risk.position_size;
            }
            const levEl = document.getElementById('leverageRatio');
            if (levEl && risk.leverage !== undefined) {
                levEl.textContent = `${risk.leverage.toFixed(2)}X`;
            }
            const exEl = document.getElementById('exposure');
            if (exEl && risk.exposure !== undefined) {
                exEl.textContent = `${(risk.exposure * 100).toFixed(0)}%`;
            }
        }

        function renderFlag(id, flag) {
            const el = document.getElementById(id);
            if (!el || !flag) return;
            let icon = '✓';
            let cls = 'hologram-text cyan-glow text-sm';
            if (flag.status === 'WARN') {
                icon = '⚠';
                cls = 'hologram-text text-blade-yellow text-sm';
            } else if (flag.status === 'DANGER') {
                icon = '✗';
                cls = 'hologram-text text-blade-orange text-sm';
            }
            if (id === 'rugPull') cls += ' font-bold';
            el.className = cls;
            el.textContent = `${icon} ${flag.status}`;
            const tooltip = el.parentElement.querySelector('.tooltip');
            if (tooltip) {
                tooltip.textContent = flag.detail || '';
            }
        }

        function updateSecurityPanel() {
            const sec = dashboardState.security;
            const panel = document.getElementById('securityPanel');
            if (!sec) {
                if (panel) panel.classList.add('hidden');
                return;
            }
            if (panel) panel.classList.remove('hidden');
            renderFlag('rugPull', sec.rug_pull);
            renderFlag('liquidity', sec.liquidity);
            renderFlag('contractVerified', sec.contract_verified);
            renderFlag('holderDistribution', sec.holder_distribution);
            renderFlag('tradingPatterns', sec.trading_patterns);
            if (sec.rug_pull && sec.rug_pull.detail) {
                const detail = document.getElementById('rugPullDetail');
                if (detail) detail.textContent = sec.rug_pull.detail;
            }
        }

        // Update positions display from API data
        async function updatePositionsDisplay(posMap) {
            let map = posMap;
            if (!map) {
                map = await apiClient.getPositions();
            }
            if (!map) return;
            dashboardState.positions = map;

            const entries = Object.entries(map);
            const qty = (p) => p.quantity ?? p.qty ?? 0;
            const activePositions = entries.filter(([, p]) => qty(p) !== 0).length;
            const longPositions = entries.filter(([, p]) => qty(p) > 0).length;
            const shortPositions = entries.filter(([, p]) => qty(p) < 0).length;

            document.getElementById('openPositionsTotal').textContent = activePositions.toString();
            document.getElementById('openPositionsActive').textContent = `${activePositions} ACTIVE`;
            document.getElementById('openPositionsBreakdown').textContent = `${longPositions} LONG • ${shortPositions} SHORT`;

            const list = document.getElementById('positionsList');
            if (list) {
                const fragment = document.createDocumentFragment();
                const seen = new Set();
                entries.forEach(([token, p]) => {
                    const q = qty(p);
                    const pnl = p.unrealized ?? p.pnl ?? 0;
                    const color = pnl >= 0 ? 'text-cyan-glow' : 'text-blade-orange';
                    let row = positionRows.get(token);
                    if (!row) {
                        row = document.createElement('div');
                        row.className = 'position-row bg-void-black/50 p-3 rounded border border-blade-amber/30 hover:border-blade-amber/60';
                        row.setAttribute('data-token', token);
                        row.addEventListener('click', async function() {
                            if (selectedPosition) selectedPosition.classList.remove('selected');
                            this.classList.add('selected');
                            selectedPosition = this;
                            await showPositionDetails(token);
                        });
                        positionRows.set(token, row);
                    }
                    row.innerHTML = `
                        <div class="flex items-center justify-between">
                            <div class="flex items-center space-x-3">
                                <div class="token-icon">${token[0] || '?'}</div>
                                <div>
                                    <div class="hologram-text text-white font-bold">$${token}</div>
                                    <div class="hologram-text text-xs text-blade-amber/60">${q}</div>
                                </div>
                            </div>
                            <div class="text-right">
                                <div class="hologram-text ${color} font-bold">${pnl >= 0 ? '+' : ''}${pnl}</div>
                            </div>
                        </div>`;
                    fragment.appendChild(row);
                    seen.add(token);
                });
                for (const [token, row] of Array.from(positionRows.entries())) {
                    if (!seen.has(token)) {
                        if (selectedPosition === row) {
                            selectedPosition = null;
                        }
                        row.remove();
                        positionRows.delete(token);
                    }
                }
                list.appendChild(fragment);
            }
        }
        
        // Update system health from API data
        function updateSystemHealth() {
            const metrics = dashboardState.metrics;
            if (metrics) {
                if (typeof metrics.cpu === 'number') {
                    document.getElementById('cpuUsage').textContent = `${metrics.cpu.toFixed(1)}%`;
                    document.getElementById('cpuBar').style.width = `${metrics.cpu}%`;
                }
                if (typeof metrics.memory === 'number') {
                    document.getElementById('memUsage').textContent = `${metrics.memory.toFixed(1)}GB`;
                    const memPct = metrics.memory_pct !== undefined ? metrics.memory_pct : (metrics.memory_total ? (metrics.memory / metrics.memory_total * 100) : 0);
                    document.getElementById('memBar').style.width = `${memPct}%`;
                }
                if (typeof metrics.net_latency_ms === 'number') {
                    document.getElementById('netLatency').textContent = `${metrics.net_latency_ms}ms`;
                    const latPct = Math.max(0, 100 - metrics.net_latency_ms);
                    document.getElementById('netLatencyBar').style.width = `${latPct}%`;
                }
            }
        }
        
        // Update regime analysis from API data
        function updateRegimeAnalysis() {
            if (!dashboardState.posterior) return;
            
            const posterior = dashboardState.posterior;
            
            // Update regime probabilities
            if (posterior.trend !== undefined) {
                const trendPercent = Math.round(posterior.trend * 100);
                const revertPercent = Math.round(posterior.revert * 100);
                const chopPercent = Math.round(posterior.chop * 100);
                
                // Update regime display
                const regimeText = trendPercent > 50 ? 'TRENDING REGIME' : 
                                 revertPercent > 50 ? 'MEAN-REVERT REGIME' : 'CHOPPY REGIME';
                
                document.querySelector('.hologram-text.text-2xl.cyan-glow.data-flicker').textContent = regimeText;
                
                // Update probability bars
                const trendBar = document.querySelector('[style*="width: 68%"]');
                if (trendBar) trendBar.style.width = `${trendPercent}%`;
                
                // Update regime triangle needle rotation
                const needle = document.getElementById('regimeNeedle');
                if (needle) {
                    const angle = trendPercent > revertPercent && trendPercent > chopPercent ? -30 :
                                 revertPercent > chopPercent ? 30 : 0;
                    needle.setAttribute('transform', `rotate(${angle} 100 120)`);
                }
            }
        }
        
        // Update license mode indicators
        function updateLicenseMode(isDemo) {
            const statusElements = document.querySelectorAll('.status-online, .status-demo');
            const modeElement = document.querySelector('.status-online, .status-demo');

            if (isDemo) {
                // Update to demo mode
                statusElements.forEach(el => {
                    el.className = el.className.replace('status-online', 'status-demo');
                });

                if (modeElement) {
                    modeElement.textContent = 'DEMO MODE';
                    modeElement.className = modeElement.className.replace('status-online', 'status-demo');
                }
            } else {
                // Update to live mode
                statusElements.forEach(el => {
                    el.className = el.className.replace('status-demo', 'status-online');
                });

                if (modeElement) {
                    modeElement.textContent = 'LIVE MODE';
                    modeElement.className = modeElement.className.replace('status-demo', 'status-online');
                }
            }
        }
        
        // Update equity and drawdown labels from risk metrics
        function updateEquityLabels() {
            if (!dashboardState.dashboard || !dashboardState.dashboard.risk) return;
            const { equity = 0, drawdown = 0 } = dashboardState.dashboard.risk;

            const equityEl = document.getElementById('equityCurrent');
            if (equityEl) {
                equityEl.textContent = `$${equity.toLocaleString('en-US', { minimumFractionDigits: 2, maximumFractionDigits: 2 })}`;
            }

            const drawdownEl = document.getElementById('maxDrawdown');
            if (drawdownEl) {
                const dd = drawdown * 100;
                drawdownEl.textContent = `${dd > 0 ? '-' : ''}${dd.toFixed(2)}%`;
            }
        }

        // Update market stats if backend provides them
        function updateMarketStats() {
            const market = dashboardState.dashboard && dashboardState.dashboard.market;
            if (!market) return;

            const priceEl = document.getElementById('assetPrice');
            if (priceEl && market.price !== undefined) {
                priceEl.textContent = `$${market.price.toLocaleString('en-US', { minimumFractionDigits: 2, maximumFractionDigits: 2 })}`;
            }

            const changeEl = document.getElementById('assetChange');
            if (changeEl && market.change !== undefined) {
                const pct = market.change;
                changeEl.textContent = `${pct >= 0 ? '+' : ''}${pct.toFixed(2)}%`;
            }

            const volumeEl = document.getElementById('volume24h');
            if (volumeEl && market.volume24h !== undefined) {
                volumeEl.textContent = `$${market.volume24h.toLocaleString('en-US', { minimumFractionDigits: 2, maximumFractionDigits: 2 })}`;
            }

            const volatilityEl = document.getElementById('volatility');
            if (volatilityEl && market.volatility !== undefined) {
                volatilityEl.textContent = market.volatility;
            }

            const liquidityEl = document.getElementById('marketLiquidity');
            if (liquidityEl && market.liquidity !== undefined) {
                liquidityEl.textContent = `$${market.liquidity.toLocaleString('en-US', { minimumFractionDigits: 2, maximumFractionDigits: 2 })}`;
            }

            const spreadEl = document.getElementById('spread');
            if (spreadEl && market.spread !== undefined) {
                spreadEl.textContent = `${market.spread}%`;
            }
        }

        function updateLicensePanel() {
            const panel = document.getElementById('licensePanel');
            if (!panel) return;
            const lic = dashboardState.license;
            if (!lic) {
                panel.classList.add('hidden');
                return;
            }
            panel.classList.remove('hidden');
            const modeEl = document.getElementById('licenseModeDetail');
            const ownerEl = document.getElementById('licenseOwner');
            const issuedEl = document.getElementById('licenseIssued');
            if (modeEl) modeEl.textContent = lic.mode || '-';
            if (ownerEl) ownerEl.textContent = lic.owner || lic.wallet || '-';
            if (issuedEl) {
                issuedEl.textContent = lic.issued_at ? new Date(lic.issued_at * 1000).toLocaleString() : '-';
            }
        }

        function populateAssetSelect(assets) {
            if (!Array.isArray(assets)) return;
            const sel = document.getElementById('assetSelect');
            if (!sel) return;
            sel.innerHTML = '';
            assets.forEach(tok => {
                const opt = document.createElement('option');
                opt.value = tok;
                opt.textContent = tok;
                sel.appendChild(opt);
            });
        }

        function populateDemoAssets(assets) {
            const sel = document.getElementById('demoAssets');
            if (!sel || !Array.isArray(assets)) return;
            sel.innerHTML = '';
            assets.forEach(tok => {
                const opt = document.createElement('option');
                opt.value = tok;
                opt.textContent = tok;
                sel.appendChild(opt);
            });
        }

        function updateModePanel() {
            const sel = document.getElementById('modeSelect');
            const cfg = document.getElementById('demoOptions');
            const cashEl = document.getElementById('demoCash');
            const assetsSel = document.getElementById('demoAssets');
            if (!sel) return;
            const mode = dashboardState.state?.mode || 'live';
            const paper = dashboardState.state?.paper || {};
            sel.value = mode;
            if (mode === 'demo') {
                cfg && cfg.classList.remove('hidden');
                if (cashEl) cashEl.value = paper.capital || 0;
                if (assetsSel && Array.isArray(dashboardState.assets)) {
                    populateDemoAssets(dashboardState.assets);
                    const opts = Array.from(assetsSel.options);
                    opts.forEach(o => {
                        o.selected = paper.assets && paper.assets.includes(o.value);
                    });
                }
            } else {
                cfg && cfg.classList.add('hidden');
            }
        }

        function renderFeatureSchema(schema) {
            const container = document.getElementById('featureSchema');
            if (!container || !schema || !Array.isArray(schema.features)) return;
            container.innerHTML = '';
            const frag = document.createDocumentFragment();
            schema.features.forEach(f => {
                const row = document.createElement('div');
                row.className = 'flex justify-between';
                row.innerHTML = `<span>${f.index}: ${f.name}</span><span class="text-blade-amber/60">${f.category || ''}</span>`;
                frag.appendChild(row);
            });
            container.appendChild(frag);
        }

        function renderFeatureSnapshot(features, timestamp) {
            const container = document.getElementById('featureSnapshot');
            if (!container || !Array.isArray(features)) return;
            container.innerHTML = '';
            const frag = document.createDocumentFragment();
            const schema = dashboardState.featureSchema?.features || [];
            features.forEach((val, i) => {
                const name = schema[i]?.name || `Feature ${i}`;
                const row = document.createElement('div');
                row.className = 'flex justify-between';
                row.innerHTML = `<span>${name}</span><span class="text-blade-amber/60">${val}</span>`;
                frag.appendChild(row);
            });
            container.appendChild(frag);
            const tsDiv = document.createElement('div');
            tsDiv.className = 'text-blade-amber/60 mt-2';
            const ts = timestamp ? new Date(timestamp * 1000) : new Date();
            tsDiv.textContent = `Snapshot at ${ts.toLocaleTimeString()}`;
            container.appendChild(tsDiv);
        }

        function updateCatalystList(list) {
            const container = document.getElementById('catalystList');
            if (!container) return;
            container.innerHTML = '';
            if (!Array.isArray(list) || list.length === 0) {
                container.innerHTML = '<div class="hologram-text text-white">None</div>';
                return;
            }
            const frag = document.createDocumentFragment();
            const colorMap = {
                high: ['bg-blade-orange', 'text-blade-orange'],
                medium: ['bg-cyan-glow', 'text-cyan-glow'],
                low: ['bg-blade-amber', 'text-blade-amber']
            };
            list.forEach(item => {
                const [bg, text] = colorMap[item.severity] || colorMap.low;
                const row = document.createElement('div');
                row.className = 'flex justify-between items-center';
                const left = document.createElement('div');
                left.className = 'flex items-center space-x-2';
                const dot = document.createElement('div');
                dot.className = `w-2 h-2 rounded-full ${bg}${item.severity === 'high' ? ' animate-pulse' : ''}`;
                left.appendChild(dot);
                const name = document.createElement('span');
                name.className = 'hologram-text text-white';
                name.textContent = item.event;
                left.appendChild(name);
                row.appendChild(left);
                const time = document.createElement('span');
                time.className = `hologram-text ${text}`;
                time.textContent = formatTimeDiff(item.timestamp);
                row.appendChild(time);
                frag.appendChild(row);
            });
            container.appendChild(frag);
        }

        function formatTimeDiff(ts) {
            const diff = ts * 1000 - Date.now();
            if (diff <= 0) return 'soon';
            const mins = Math.floor(diff / 60000);
            const days = Math.floor(mins / 1440);
            const hours = Math.floor((mins % 1440) / 60);
            const minutes = mins % 60;
            const parts = [];
            if (days) parts.push(`${days}D`);
            if (hours) parts.push(`${hours}H`);
            parts.push(`${minutes}M`);
            return parts.join(' ');
        }

        function updateFeatureStream(features) {
            const container = document.getElementById('featureStream');
            if (!container || !Array.isArray(features)) return;
            container.innerHTML = '';
            features.slice(0, 16).forEach((val, idx) => {
                const div = document.createElement('div');
                div.className = 'flex justify-between';
                div.innerHTML = `<span>${idx}</span><span>${Number(val).toFixed(4)}</span>`;
                container.appendChild(div);
            });
        }

        async function loadAnalytics() {
            if (document.hidden) return;
            showWhaleLoading();
            showSmartMoneyLoading();
            showCopyTradingLoading();
            try {
                const [whales, flow, copyList, strategies, arb, perf, br, riskStats] = await Promise.all([
                      apiClient.get('/whales').catch(() => null),
                      apiClient.get('/smart-money-flow').catch(() => null),
                      apiClient.get('/copy-trading').catch(() => null),
                      apiClient.get('/strategies').catch(() => null),
                      apiClient.get('/arbitrage').catch(() => null),
                      apiClient.get(`/strategy/performance?period=${strategyPeriod}`).catch(() => null),
                      apiClient.get('/strategy/breakdown').catch(() => null),
                      apiClient.get('/strategy/risk').catch(() => null)
                  ]);
                  updateWhaleStats(whales);
                  updateSmartMoney(flow);
                  updateCopyTrading(copyList);
                  updateStrategyMatrix(strategies);
                  if (arb) updateArbitrage(arb);
                  updateStrategyPerformance(perf);
                  updateStrategyBreakdown(br);
                  updateRiskAnalytics(riskStats);
              } catch (err) {
                  console.error('Analytics load failed', err);
                  updateWhaleStats(null);
                  updateSmartMoney(null);
                  updateCopyTrading(null);
                  updateStrategyMatrix(null);
                  updateStrategyPerformance(null);
                  updateStrategyBreakdown(null);
                  updateRiskAnalytics(null);
              }
          }

          function showWhaleLoading() {
              ['whaleFollowing','whaleSuccessRate','whaleCopiedToday','whaleProfit'].forEach(id => {
                  const el = document.getElementById(id);
                  if (el) {
                      el.textContent = '-';
                      el.classList.add('animate-pulse');
                  }
              });
          }

          function showSmartMoneyLoading() {
              ['smartMoneyValue','smartMoneyTrend'].forEach(id => {
                  const el = document.getElementById(id);
                  if (el) {
                      el.textContent = '--';
                      el.classList.add('animate-pulse');
                  }
              });
          }

          function showCopyTradingLoading() {
              const container = document.getElementById('whaleAlerts');
              if (container) {
                  container.innerHTML = '<div class="hologram-text text-blade-amber/60 text-xs animate-pulse">LOADING...</div>';
              }
          }

          function updateWhaleStats(data) {
              const ids = ['whaleFollowing','whaleSuccessRate','whaleCopiedToday','whaleProfit'];
              if (!data) {
                  ids.forEach(id => {
                      const el = document.getElementById(id);
                      if (el) {
                          el.textContent = '-';
                          el.classList.remove('animate-pulse');
                      }
                  });
                  return;
              }
              const f = document.getElementById('whaleFollowing');
              if (f) {
                  f.textContent = data.following != null ? `${data.following}` : '-';
                  f.classList.remove('animate-pulse');
              }
              const sr = document.getElementById('whaleSuccessRate');
              if (sr) {
                  sr.textContent = data.success_rate != null ? `${data.success_rate}%` : '-';
                  sr.classList.remove('animate-pulse');
              }
              const ct = document.getElementById('whaleCopiedToday');
              if (ct) {
                  ct.textContent = data.copied_today != null ? `${data.copied_today}` : '-';
                  ct.classList.remove('animate-pulse');
              }
              const prof = document.getElementById('whaleProfit');
              if (prof) {
                  prof.textContent = data.profit != null ? `${data.profit} SOL` : '-';
                  prof.classList.remove('animate-pulse');
              }
          }

          function updateSmartMoney(flow) {
              const val = document.getElementById('smartMoneyValue');
              const tr = document.getElementById('smartMoneyTrend');
              if (!flow) {
                  if (val) {
                      val.textContent = '--';
                      val.classList.remove('animate-pulse');
                  }
                  if (tr) {
                      tr.textContent = '--';
                      tr.classList.remove('animate-pulse');
                  }
                  return;
              }
              if (val) {
                  val.textContent = flow.net_inflow != null ? `${flow.net_inflow} SOL` : '--';
                  val.classList.remove('animate-pulse');
              }
              if (tr) {
                  tr.textContent = flow.trend || '--';
                  tr.classList.remove('animate-pulse');
              }
          }

          function updateCopyTrading(list) {
              const container = document.getElementById('whaleAlerts');
              if (!container) return;
              container.innerHTML = '';
              if (!Array.isArray(list) || list.length === 0) {
                  container.innerHTML = '<div class="hologram-text text-blade-amber/60 text-xs">DATA UNAVAILABLE</div>';
                  return;
              }
              list.forEach(item => {
                  const div = document.createElement('div');
                  div.className = 'flex items-center justify-between text-xs';
                  div.innerHTML = `<span class="hologram-text text-white">${item.whale}</span>` +
                      `<span class="hologram-text text-cyan-glow">${item.profit ?? ''}</span>`;
                  container.appendChild(div);
              });
          }

          function updateStrategyMatrix(strategies) {
              const container = document.getElementById('strategyMatrix');
              if (!container) return;
              container.innerHTML = '';
              if (!Array.isArray(strategies) || strategies.length === 0) {
                  container.innerHTML = '<div class="hologram-text text-blade-amber/60 text-xs">DATA UNAVAILABLE</div>';
                  return;
              }
              strategies.forEach(s => {
                  const div = document.createElement('div');
                  div.className = 'bg-void-black/50 p-4 rounded border border-blade-cyan/30';
                  div.innerHTML = `<div class="flex justify-between items-center mb-3">` +
                      `<div class="hologram-text text-white font-bold">${s.name}</div>` +
                      `<div class="hologram-text text-cyan-glow text-sm font-bold">${s.trades} trades • ${s.pnl} SOL</div>` +
                      `</div>` +
                      `<div class="grid grid-cols-3 gap-3 text-xs">` +
                      `<div><div class="hologram-text text-blade-amber/80">CONFIDENCE</div><div class="hologram-text text-cyan-glow font-bold">${s.confidence}%</div></div>` +
                      `<div><div class="hologram-text text-blade-amber/80">TARGETS</div><div class="hologram-text text-white font-bold">${s.targets}</div></div>` +
                      `<div><div class="hologram-text text-blade-amber/80">SUCCESS</div><div class="hologram-text text-cyan-glow font-bold">${s.success}%</div></div>` +
                      `</div>`;
                  container.appendChild(div);
              });
          }

          function updateStrategyPerformance(perf) {
              const container = document.getElementById('strategyPerformance');
              if (!container) return;
              container.innerHTML = '';
              if (!Array.isArray(perf) || perf.length === 0) {
                  container.innerHTML = '<div class="hologram-text text-blade-amber/60 text-xs">DATA UNAVAILABLE</div>';
                  return;
              }
              perf.forEach(p => {
                  const div = document.createElement('div');
                  div.innerHTML = `<div class="hologram-text text-white font-bold">${p.name}</div>` +
                      `<div class="hologram-text text-cyan-glow">${p.pnl} SOL • ${(p.win_rate * 100).toFixed(1)}% WR</div>`;
                  container.appendChild(div);
              });
          }

          function updateStrategyBreakdown(list) {
              const container = document.getElementById('strategyBreakdown');
              if (!container) return;
              container.innerHTML = '';
              if (!Array.isArray(list) || list.length === 0) {
                  container.innerHTML = '<div class="hologram-text text-blade-amber/60 text-xs">DATA UNAVAILABLE</div>';
                  return;
              }
              list.forEach(item => {
                  const div = document.createElement('div');
                  div.className = 'flex justify-between items-center text-xs';
                  div.innerHTML = `<span class="hologram-text text-white">${item.name}</span>` +
                      `<span class="hologram-text text-cyan-glow">${item.pnl} SOL • ${(item.win_rate * 100).toFixed(1)}%</span>`;
                  container.appendChild(div);
              });
          }

          function updateRiskAnalytics(data) {
              const container = document.getElementById('riskAnalytics');
              if (!container) return;
              container.innerHTML = '';
              if (!data) {
                  container.innerHTML = '<div class="hologram-text text-blade-amber/60 text-xs">DATA UNAVAILABLE</div>';
                  return;
              }
              const entries = [
                  ['SHARPE', data.sharpe?.toFixed(2)],
                  ['MAX DD', data.max_drawdown != null ? `${(data.max_drawdown * 100).toFixed(1)}%` : null],
                  ['VOLATILITY', data.volatility != null ? `${(data.volatility * 100).toFixed(1)}%` : null],
                  ['CALMAR', data.calmar?.toFixed(2)],
              ];
              entries.forEach(([label, val]) => {
                  const div = document.createElement('div');
                  div.innerHTML = `<div class="hologram-text text-blade-amber/80">${label}</div>` +
                      `<div class="hologram-text text-white font-bold">${val ?? '-'}</div>`;
                  container.appendChild(div);
              });
          }

          function updateArbitrage(data) {
              const statusText = document.getElementById('arbStatusText');
              const statusDot = document.getElementById('arbStatusDot');
              if (statusText) statusText.textContent = data.status || '--';
              if (statusDot) statusDot.className = `w-2 h-2 rounded-full ${data.status === 'ACTIVE' ? 'bg-cyan-glow' : 'bg-blade-amber'}`;
              const t = document.getElementById('arbTrades');
              if (t) t.textContent = data.trades != null ? data.trades : '-';
              const pnl = document.getElementById('arbPnL');
              if (pnl) pnl.textContent = data.pnl != null ? `${data.pnl} SOL` : '-';
              const spread = document.getElementById('arbSpread');
              if (spread) spread.textContent = data.spread != null ? `${data.spread}%` : '-';
              const opp = document.getElementById('arbOpps');
              if (opp) opp.textContent = data.opportunities != null ? data.opportunities : '-';
              const lat = document.getElementById('arbLatency');
              if (lat) lat.textContent = data.latency != null ? `${data.latency}ms` : '-';
          }

          let socialPollDelay = 60000;
          async function loadSocialFeeds() {
              if (document.hidden) return;
              try {
                  const [trending, influencers, pulse, news] = await Promise.all([
                      apiClient.get('/sentiment/trending').catch(() => null),
                      apiClient.get('/sentiment/influencers').catch(() => null),
                      apiClient.get('/sentiment/pulse').catch(() => null),
                      apiClient.get('/news').catch(() => null)
                  ]);
                  if (trending) updateTrending(trending);
                  if (influencers) updateInfluencers(influencers);
                  if (pulse) updatePulse(pulse);
                  if (news) updateNews(news);
                  socialPollDelay = 60000;
              } catch (err) {
                  console.error('Social feed load failed', err);
                  socialPollDelay = Math.min(socialPollDelay * 2, 3600000);
              } finally {
                  pollingIntervals.push(setTimeout(loadSocialFeeds, socialPollDelay));
              }
          }

          function updateTrending(tokens) {
              const container = document.getElementById('trendingTokens');
              if (!container) return;
              container.innerHTML = '';
              if (!Array.isArray(tokens) || tokens.length === 0) {
                  container.innerHTML = '<div class="hologram-text text-blade-amber/60">DATA UNAVAILABLE</div>';
                  return;
              }
              tokens.forEach(t => {
                  const row = document.createElement('div');
                  row.className = 'flex items-center justify-between';
                  row.innerHTML = `<div class="flex items-center space-x-3"><div class="w-6 h-6 bg-gradient-to-r from-cyan-glow to-blade-cyan rounded-full flex items-center justify-center text-xs font-bold">🔥</div><div><div class="hologram-text text-white font-bold">${t.symbol}</div><div class="hologram-text text-xs text-blade-amber/60">${t.mentions} mentions</div></div></div><div class="text-right"><div class="hologram-text text-cyan-glow font-bold">${t.sentiment}</div><div class="hologram-text text-xs text-blade-amber/60">SENTIMENT</div></div>`;
                  container.appendChild(row);
              });
          }

          function updateInfluencers(list) {
              const container = document.getElementById('influencerAlerts');
              if (!container) return;
              container.innerHTML = '';
              if (!Array.isArray(list) || list.length === 0) {
                  container.innerHTML = '<div class="hologram-text text-blade-amber/60">DATA UNAVAILABLE</div>';
                  return;
              }
              list.forEach(i => {
                  const row = document.createElement('div');
                  row.className = 'flex items-center justify-between text-xs';
                  row.innerHTML = `<div class="flex items-center space-x-2"><span class="hologram-text text-white">${i.handle}</span></div><div class="text-right"><div class="hologram-text text-cyan-glow">${i.message}</div><div class="hologram-text text-blade-amber/60">${i.followers} followers</div></div>`;
                  container.appendChild(row);
              });
          }

          function updatePulse(p) {
              const fg = document.getElementById('fearGreedValue');
              const fgBar = document.getElementById('fearGreedBar');
              if (fg && p.fear_greed !== undefined) fg.textContent = p.fear_greed;
              if (fgBar && p.fear_greed_pct !== undefined) fgBar.style.width = `${p.fear_greed_pct}%`;
              const sv = document.getElementById('socialVolumeValue');
              const svBar = document.getElementById('socialVolumeBar');
              if (sv && p.social_volume !== undefined) sv.textContent = p.social_volume;
              if (svBar && p.social_volume_pct !== undefined) svBar.style.width = `${p.social_volume_pct}%`;
              const fomo = document.getElementById('fomoValue');
              const fomoBar = document.getElementById('fomoBar');
              if (fomo && p.fomo !== undefined) fomo.textContent = p.fomo;
              if (fomoBar && p.fomo_pct !== undefined) fomoBar.style.width = `${p.fomo_pct}%`;
          }

          function updateNews(list) {
              const container = document.getElementById('newsFeed');
              if (!container) return;
              container.innerHTML = '';
              if (!Array.isArray(list) || list.length === 0) {
                  container.innerHTML = '<div class="hologram-text text-blade-amber/60">NO NEWS</div>';
                  return;
              }
              let lastId = parseInt(localStorage.getItem('last_news_id') || '0', 10);
              list.forEach(item => {
                  if (item.id && item.id > lastId) lastId = item.id;
                  const row = document.createElement('div');
                  row.className = 'flex items-start space-x-2';
                  row.innerHTML = `<div class="w-2 h-2 bg-blade-orange rounded-full mt-1"></div><div><div class="hologram-text text-white">${item.title}</div><div class="hologram-text text-blade-amber/60">Source: ${item.source} • Confidence: ${item.confidence}%</div></div>`;
                  container.appendChild(row);
              });
              localStorage.setItem('last_news_id', String(lastId));
          }

        let equityChartInstance = null;
        async function loadEquityChart(tf = '1H') {
            const container = document.getElementById('equityContainer');
            if (!container) return;
            try {
                const res = await fetch(`${apiClient.baseURL}/chart/portfolio?tf=${tf}`, {
                    headers: apiClient.apiKey ? { 'X-API-Key': apiClient.apiKey } : {}
                });
                if (!res.ok) {
                    container.innerHTML = '<div class="hologram-text text-center text-blade-amber">DATA UNAVAILABLE</div>';
                    return;
                }
                const data = await res.json();
                if (data.url) {
                    container.innerHTML = `<iframe src="${data.url}" class="w-full h-full"></iframe>`;
                    return;
                }
                if (data.series) {
                    container.innerHTML = '<canvas id="equityCanvas" class="w-full h-full"></canvas>';
                    const ctx = document.getElementById('equityCanvas').getContext('2d');
                    if (equityChartInstance) equityChartInstance.destroy();
                    equityChartInstance = new Chart(ctx, {
                        type: 'line',
                        data: {
                            labels: data.series.map(p => new Date(p[0] * 1000)),
                            datasets: [{
                                label: 'Equity',
                                data: data.series.map(p => p[1]),
                                borderColor: '#00e5ff',
                                backgroundColor: 'rgba(0,229,255,0.2)',
                                fill: true,
                                tension: 0.1
                            }]
                        },
                        options: {
                            scales: {
                                x: { type: 'time', time: { unit: 'hour' } }
                            },
                            plugins: { legend: { display: false } }
                        }
                    });
                    const equity = dashboardState.dashboard?.risk?.equity;
                    if (equity !== undefined && data.series.length && data.series[0][1] !== equity) {
                        console.warn('Equity chart first point mismatch', data.series[0][1], equity);
                    }
                    return;
                }
                container.innerHTML = '<div class="hologram-text text-center text-blade-amber">DATA UNAVAILABLE</div>';
            } catch (err) {
                console.error('Failed to load equity chart', err);
                container.innerHTML = '<div class="hologram-text text-center text-blade-amber">DATA UNAVAILABLE</div>';
            }
        }

        document.querySelectorAll('#equityChart [data-tf]').forEach(btn => {
            btn.addEventListener('click', () => {
                document.querySelectorAll('#equityChart [data-tf]').forEach(b => {
                    b.classList.remove('bg-blade-amber/20', 'text-blade-amber', 'border-blade-amber/50');
                    b.classList.add('bg-void-black/50', 'text-blade-amber/60', 'border-blade-amber/20');
                });
                btn.classList.remove('bg-void-black/50', 'text-blade-amber/60', 'border-blade-amber/20');
                btn.classList.add('bg-blade-amber/20', 'text-blade-amber', 'border-blade-amber/50');
                loadEquityChart(btn.dataset.tf);
            });
        });
        
        // WebSocket integration for real-time updates
        class SolSeekerWebSocket {
            constructor() {
                this.connections = new Map();
                this.reconnectAttempts = new Map();
                this.maxReconnectAttempts = 5;
            }

            connect(endpoint, onMessage, onError = null) {
                const wsUrl = apiClient.getWebSocketURL(endpoint);

                try {
                    const ws = new WebSocket(wsUrl);

                    ws.onopen = () => {
                        console.log(`WebSocket connected: ${endpoint}`);
                        this.reconnectAttempts.set(endpoint, 0);
                    };

                    ws.onmessage = (event) => {
                        try {
                            const data = JSON.parse(event.data);
                            requestAnimationFrame(() => onMessage(data));
                        } catch (error) {
                            console.error('Error parsing WebSocket message:', error);
                        }
                    };

                    ws.onclose = (event) => {
                        console.log(`WebSocket disconnected: ${endpoint}`);
                        if (event.code === 1008) {
                            apiClient.promptForApiKey();
                        }
                        this.handleReconnect(endpoint, onMessage, onError);
                    };

                    ws.onerror = (error) => {
                        console.error(`WebSocket error on ${endpoint}:`, error);
                        if (onError) onError(error);
                    };

                    this.connections.set(endpoint, ws);

                } catch (error) {
                    console.error(`Failed to create WebSocket for ${endpoint}:`, error);
                    if (onError) onError(error);
                }
            }

            handleReconnect(endpoint, onMessage, onError) {
                const attempts = this.reconnectAttempts.get(endpoint) || 0;
                if (attempts < this.maxReconnectAttempts) {
                    const nextAttempt = attempts + 1;
                    this.reconnectAttempts.set(endpoint, nextAttempt);
                    const delay = Math.pow(2, nextAttempt) * 1000; // Exponential backoff

                    console.log(`Attempting to reconnect to ${endpoint} in ${delay}ms (attempt ${nextAttempt})`);

                    setTimeout(() => {
                        this.connect(endpoint, onMessage, onError);
                    }, delay);
                } else {
                    showToast(`Unable to reconnect to ${endpoint}`);
                    if (onError) onError(new Error('max reconnect attempts reached'));
                }
            }

            disconnect(endpoint) {
                const ws = this.connections.get(endpoint);
                if (ws) {
                    ws.close();
                    this.connections.delete(endpoint);
                    this.reconnectAttempts.delete(endpoint);
                }
            }

            disconnectAll() {
                this.connections.forEach((ws) => {
                    ws.close();
                });
                this.connections.clear();
                this.reconnectAttempts.clear();
            }
        }
        
        // Initialize WebSocket connections
        const wsClient = new SolSeekerWebSocket();

        function clearPollingIntervals() {
            pollingIntervals.forEach(clearInterval);
            pollingIntervals.length = 0;
        }

        function updateTradingFeed() {
            wsClient.connect('/orders/ws', ({ token, quantity, qty, side, price, timestamp, posterior, strategy, status }) => {
                if (feedPaused) return;

                const q = quantity ?? qty;
                if (!side) {
                    console.warn('ws order missing side', { token, quantity: q, price, status });
                    return;
                }
                addFeedEntry({
                    timestamp: new Date(timestamp ? timestamp * 1000 : Date.now()),
                    type: side.toUpperCase(),
                    message: `${token} x${q} @ $${price}`,
                    strategy: strategy || 'API',
                    confidence: posterior?.confidence ? `${(posterior.confidence * 100).toFixed(0)}%` : null,
                    color: side === 'buy' ? 'blade-cyan' : 'blade-amber'
                });

                if (posterior) {
                    addFeedEntry({
                        timestamp: new Date(timestamp ? timestamp * 1000 : Date.now()),
                        type: 'NEURAL',
                        message: `${posterior.action} - ${token}`,
                        strategy: 'AI',
                        confidence: posterior.confidence ? `${(posterior.confidence * 100).toFixed(0)}%` : null,
                        color: 'blade-cyan'
                    });
                }

                if (status === 'closed') {
                    appendHistoryEntry({ token, quantity: q, side, price, timestamp, status });
                }
            });
        }

        // Connect to real-time feeds
        function initializeWebSockets() {
            // Dashboard updates
            wsHeartbeatTs = Date.now();
            wsClient.connect('/dashboard/ws', (data) => {
                wsHeartbeatTs = Date.now();
                if (data.risk) {
                    dashboardState.dashboard = dashboardState.dashboard || {};
                    dashboardState.dashboard.risk = data.risk;
                    updatePortfolioMetrics();
                    updateRiskMetrics();
                }
                if (data.security) {
                    dashboardState.security = data.security;
                    updateSecurityPanel();
                }
            });
            
            // Position updates
            wsClient.connect('/positions/ws', (data) => {
                dashboardState.positions = data;
                updatePositionsDisplay(data);
            });
            
            // Features/AI updates
            wsClient.connect('/features/ws', (data) => {
                if (Array.isArray(data.features)) {
                    dashboardState.features = data.features;
                    updateFeatureStream(data.features);
                    const ts = data.event?.timestamp;
                    renderFeatureSnapshot(data.features, ts);
                }
            });
            
            // Posterior/regime updates
            wsClient.connect('/posterior/ws', (data) => {
                if (data.trend !== undefined) {
                    updateRegimeAnalysis();
                }
            });

            // Debug logs
            wsClient.connect('/logs/ws', (data) => {
                appendLog(data);
            });

            // Order events feed
            updateTradingFeed();

        }
        
        // Initialize dashboard
        async function initializeDashboard() {
            clearPollingIntervals();
            console.log('Initializing Sol-Seeker Dashboard...');
            
            // Check API availability first
            const health = await apiClient.getHealth();
            if (health) {
                console.log('API connection established:', health);
                await apiClient.ensureApiKey();

                try {
                    const state = await apiClient.getState();
                    if (state && state.settings) {
                        applySettings(state.settings);
                    }
                    if (state) {
                        dashboardState.state = state;
                        updateModePanel();
                        dashboardState.isDemo = state.mode === 'demo';
                        updateLicenseMode(dashboardState.isDemo);
                        tradingActive = !!state.running;
                        updateTradingButton();
                    }
                } catch (err) {
                    console.error('Failed to load state:', err);
                    dashboardState.isDemo = true;
                    updateLicenseMode(true);
                }

                // Initialize WebSocket connections for real-time updates
                initializeWebSockets();

                // Initial data fetch
                  await updateDashboardData();
                  await loadEquityChart('1H');
                  await loadAnalytics();
                  loadSocialFeeds();

                // Set up periodic updates (less frequent since we have WebSockets)
                  pollingIntervals.push(setInterval(updateDashboardData, 10000)); // Update every 10 seconds
                  pollingIntervals.push(setInterval(loadAnalytics, 60000));
                pollRpcLatency();
                pollingIntervals.push(setInterval(pollRpcLatency, 5000));
                pollSystemStatus();
                pollingIntervals.push(setInterval(pollSystemStatus, 30000));
                pollMetrics();
                pollingIntervals.push(setInterval(pollMetrics, 5000));
                updateRpcTooltip();
                pollingIntervals.push(setInterval(updateRpcTooltip, 1000));
                checkWsHeartbeat();
                pollingIntervals.push(setInterval(checkWsHeartbeat, 1000));

            } else {
                console.warn('API connection failed - running in demo mode');
                updateLicenseMode(true);
                dashboardState.isDemo = true;

                // In demo mode, use simulated updates
                pollingIntervals.push(setInterval(updateDashboardData, 5000));
            }

            console.log('Dashboard initialization complete');
        }
        
        // Start dashboard when page loads
        document.addEventListener('DOMContentLoaded', function() {
            initializeDashboard();
            document.querySelectorAll('.strategy-period').forEach(btn => {
                btn.addEventListener('click', async () => {
                    strategyPeriod = btn.dataset.period;
                    document.querySelectorAll('.strategy-period').forEach(b => {
                        const active = b.dataset.period === strategyPeriod;
                        b.classList.toggle('bg-blade-amber/20', active);
                        b.classList.toggle('text-blade-amber', active);
                        b.classList.toggle('border-blade-amber/50', active);
                        b.classList.toggle('bg-void-black/50', !active);
                        b.classList.toggle('text-blade-amber/60', !active);
                        b.classList.toggle('border-blade-amber/20', !active);
                    });
                    await loadAnalytics();
                });
            });
        });
        
        // Handle page visibility changes to pause/resume updates
        document.addEventListener('visibilitychange', function() {
            if (document.hidden) {
                console.log('Dashboard paused (tab hidden)');
                clearPollingIntervals();
                wsClient.disconnectAll();
            } else {
                console.log('Dashboard resumed (tab visible)');
                initializeDashboard();
            }
        });
        
        // Position details modal
        async function showPositionDetails(token) {
            const modal = document.getElementById('positionModal');
            const modalTitle = document.getElementById('modalTitle');
            const modalContent = document.getElementById('modalContent');

            const positions = await apiClient.getPositions();
            const pos = positions && positions[token];

            if (!pos) {
                modalTitle.textContent = 'POSITION NOT FOUND';
                modalContent.innerHTML = `<p class="hologram-text text-blade-orange text-center">No position data available for ${token}</p>`;
                modal.classList.remove('hidden');
                return;
            }

            const formatPrice = (v) => v != null ? `$${v}` : 'N/A';
            const pnlValue = pos.pnl ?? pos.unrealized;
            const pnlText = pnlValue != null ? `${pnlValue >= 0 ? '+' : ''}${pnlValue}` : 'N/A';
            const pnlClass = pnlValue != null && pnlValue < 0 ? 'text-blade-orange' : 'text-cyan-glow';

            const data = {
                symbol: pos.symbol || `$${token}`,
                name: pos.name || token,
                quantity: pos.quantity ?? pos.qty ?? 'N/A',
                entryPrice: formatPrice(pos.entryPrice ?? pos.cost),
                currentPrice: formatPrice(pos.currentPrice ?? pos.price),
                pnl: pnlText,
                pnlClass,
                strategy: pos.strategy || 'N/A',
                wallet: pos.wallet || 'N/A',
                entryTime: pos.entryTime || pos.entry_time || 'N/A'
            };

            modalTitle.textContent = `${data.symbol} POSITION DETAILS`;

            modalContent.innerHTML = `
                <div class="space-y-4">
                    <div class="bg-void-black/50 p-4 rounded border border-blade-amber/30">
                        <h4 class="hologram-text text-blade-amber font-bold mb-3">POSITION INFO</h4>
                        <div class="space-y-2 text-sm">
                            <div class="flex justify-between">
                                <span class="hologram-text text-blade-amber/80">TOKEN:</span>
                                <span class="hologram-text text-white">${data.name}</span>
                            </div>
                            <div class="flex justify-between">
                                <span class="hologram-text text-blade-amber/80">QUANTITY:</span>
                                <span class="hologram-text text-white">${data.quantity}</span>
                            </div>
                            <div class="flex justify-between">
                                <span class="hologram-text text-blade-amber/80">ENTRY PRICE:</span>
                                <span class="hologram-text text-white">${data.entryPrice}</span>
                            </div>
                            <div class="flex justify-between">
                                <span class="hologram-text text-blade-amber/80">CURRENT PRICE:</span>
                                <span class="hologram-text text-white">${data.currentPrice}</span>
                            </div>
                            <div class="flex justify-between">
                                <span class="hologram-text text-blade-amber/80">UNREALIZED P&L:</span>
                                <span class="hologram-text ${data.pnlClass}">${data.pnl}</span>
                            </div>
                        </div>
                    </div>

                    <div class="bg-void-black/50 p-4 rounded border border-blade-cyan/30">
                        <h4 class="hologram-text text-white font-bold mb-3">STRATEGY & TIMING</h4>
                        <div class="space-y-2 text-sm">
                            <div class="flex justify-between">
                                <span class="hologram-text text-blade-amber/80">STRATEGY:</span>
                                <span class="hologram-text text-cyan-glow">${data.strategy}</span>
                            </div>
                            <div class="flex justify-between">
                                <span class="hologram-text text-blade-amber/80">WALLET:</span>
                                <span class="hologram-text text-white">${data.wallet}</span>
                            </div>
                            <div class="flex justify-between">
                                <span class="hologram-text text-blade-amber/80">ENTRY TIME:</span>
                                <span class="hologram-text text-white">${data.entryTime}</span>
                            </div>
                        </div>
                    </div>
                </div>`;
            modal.classList.remove('hidden');
        }

    </script>
</body>
</html>
